{"ast":null,"code":"var _jsxFileName = \"/home/gauravpendherkar/DemoWriti/src/containers/Permission/index.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport PermissionSidebar from '../SubscriptionUpsert/components/SideBar';\nimport PermissionContainer from './components/PermissionContainer';\nimport axios from '../../services/api/services/common';\nimport { getAll, remove } from '../../services/api/routes/permission';\nimport { sortArrayDesc } from '../../util/common';\nimport { Toast } from '../../components/common';\nimport { USER_TYPE, isPharmacyUser } from '../../constants/User';\nlet delayDebounceFn;\n\nclass RolePermissions extends Component {\n  constructor(props) {\n    var _props$authUser$homeI, _props$authUser$pharm;\n\n    super(props);\n\n    this.fetch = async () => {\n      this.setState({\n        listLoader: this.state.filter.page === 1 ? true : false\n      });\n      const data = {\n        query: { ...this.state.filter\n        }\n      };\n\n      try {\n        let res = await axios({ ...getAll,\n          data\n        });\n\n        if (res) {\n          if (res.code === 'OK') {\n            let listData = this.state.filter.page === 1 ? [] : [...this.state.listData];\n            listData = listData.concat(res.data.data);\n            this.setState({\n              hasMore: listData.length === res.data.count ? false : true,\n              loading: false,\n              count: res.data.count,\n              listData: listData,\n              detail: listData.length > 0 ? listData[0] : null\n            });\n          } else Toast.error(res.message);\n        }\n\n        this.setState({\n          listLoader: false\n        });\n      } catch {\n        this.setState({\n          listLoader: false,\n          loading: false\n        });\n      }\n    };\n\n    this.handleInfiniteLoad = () => {\n      let tempArr = [...this.state.listData];\n\n      if (tempArr.length === this.state.count) {\n        this.setState({\n          hasMore: false\n        });\n        return;\n      }\n\n      this.setState({\n        loading: true,\n        filter: { ...this.state.filter,\n          page: this.state.filter.page + 1\n        }\n      }, () => this.fetch());\n    };\n\n    this.handleSearch = value => {\n      if (delayDebounceFn) {\n        clearTimeout(delayDebounceFn);\n        delayDebounceFn = null;\n      }\n\n      delayDebounceFn = setTimeout(() => {\n        this.setState({\n          filter: { ...this.state.filter,\n            search: {\n              keyword: value,\n              keys: ['name']\n            }\n          }\n        }, () => this.fetch());\n      }, 600);\n    };\n\n    this.handleAdd = () => {\n      this.setState({\n        curDetail: { ...this.state.detail\n        }\n      });\n      this.setState({\n        visibleAdd: true,\n        detail: null\n      });\n    };\n\n    this.submit = () => {\n      this.props.form.validateFields((error, value) => {\n        console.log(error, value);\n      });\n    };\n\n    this.handleEdit = detail => {\n      this.setState({\n        curDetail: { ...detail\n        }\n      });\n      this.setState({\n        edit: true,\n        visibleAdd: true,\n        detail\n      });\n    };\n\n    this.handleDelete = async data => {\n      this.setState({\n        listLoader: true\n      });\n      const {\n        method,\n        url,\n        baseURL\n      } = remove;\n      let res = await axios({\n        baseURL,\n        method,\n        url: url + data._id\n      });\n\n      if (res && res.code === 'OK') {\n        Toast.success(res.message);\n        let listData = [...this.state.listData];\n        let index = listData.findIndex(x => x._id === data._id);\n        if (index >= 0) listData.splice(index, 1);\n        this.setState({\n          listData: listData\n        });\n\n        if (this.state.detail && this.state.detail._id && this.state.detail._id !== data._id) {//stay as it is while delete\n        } else {\n          this.setState({\n            detail: listData.length > 0 ? listData[0] : null\n          });\n        }\n      } else if (res) {\n        Toast.error(res.message);\n      }\n\n      this.setState({\n        listLoader: false\n      });\n    };\n\n    this.handleSelect = detail => {\n      this.setState({\n        visibleAdd: false,\n        edit: false,\n        detail\n      });\n    };\n\n    this.handleCancel = (str, params) => {\n      let newDetail = null;\n\n      if (str === 'add') {\n        newDetail = this.state.listData[0];\n      } else if (this.state.curDetail) {\n        newDetail = { ...this.state.curDetail,\n          name: params ? params.name : this.state.curDetail.name\n        };\n      }\n\n      this.setState({\n        visibleAdd: false,\n        edit: false,\n        detail: newDetail\n      });\n    };\n\n    this.handleUpdate = params => {\n      let edit = false;\n      let listData = [...this.state.listData];\n      let index = listData.findIndex(x => x._id === params._id);\n\n      if (index >= 0) {\n        //edit\n        edit = true;\n        listData[index] = params;\n      } else listData.push(params);\n\n      listData = sortArrayDesc(listData, 'createdAt');\n      this.setState({\n        listData: listData\n      });\n      this.handleCancel(edit ? 'edit' : 'add', edit ? params : null);\n    };\n\n    this.state = {\n      visibleAdd: false,\n      listLoader: false,\n      loading: false,\n      hasMore: true,\n      edit: false,\n      detail: null,\n      listData: [],\n      count: 0,\n      filter: {\n        page: 1,\n        limit: 15,\n        fields: ['isActive', '_id', 'name', 'groupPermissions', 'createdAt'],\n        sortBy: {\n          createdAt: -1\n        },\n        find: {\n          homeId: props.authUser.type === USER_TYPE.HOME.ADMIN ? (_props$authUser$homeI = props.authUser.homeId) === null || _props$authUser$homeI === void 0 ? void 0 : _props$authUser$homeI._id : undefined,\n          pharmacyId: props.authUser.type === USER_TYPE.PHARMACY.ADMIN ? (_props$authUser$pharm = props.authUser.pharmacyId) === null || _props$authUser$pharm === void 0 ? void 0 : _props$authUser$pharm._id : undefined\n        }\n      },\n      curDetail: null\n    };\n  }\n\n  componentDidMount() {\n    this.fetch();\n  }\n\n  render() {\n    const {\n      visibleAdd,\n      edit,\n      detail,\n      listData,\n      listLoader,\n      hasMore,\n      loading\n    } = this.state;\n    const {\n      authUser\n    } = this.props;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"addpermission_wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(PermissionSidebar, {\n      isRole: true,\n      onAdd: this.handleAdd,\n      listData: listData,\n      onEdit: this.handleEdit,\n      onDelete: this.handleDelete,\n      onSelect: this.handleSelect,\n      onSearch: this.handleSearch,\n      onInfiniteOnLoad: this.handleInfiniteLoad,\n      hasMore: hasMore,\n      loading: loading,\n      edit: edit,\n      detail: detail,\n      listLoader: listLoader,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(PermissionContainer, {\n      visibleAdd: visibleAdd,\n      onAdd: this.handleUpdate,\n      edit: edit,\n      onCancel: this.handleCancel,\n      detail: detail,\n      authUser: authUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 21\n      }\n    }))));\n  }\n\n}\n\nconst mapStateToProps = ({\n  auth\n}) => {\n  const {\n    authUser\n  } = auth;\n  return {\n    authUser\n  };\n};\n\nexport default connect(mapStateToProps)(RolePermissions);\n;","map":{"version":3,"sources":["/home/gauravpendherkar/DemoWriti/src/containers/Permission/index.js"],"names":["React","Component","connect","PermissionSidebar","PermissionContainer","axios","getAll","remove","sortArrayDesc","Toast","USER_TYPE","isPharmacyUser","delayDebounceFn","RolePermissions","constructor","props","fetch","setState","listLoader","state","filter","page","data","query","res","code","listData","concat","hasMore","length","count","loading","detail","error","message","handleInfiniteLoad","tempArr","handleSearch","value","clearTimeout","setTimeout","search","keyword","keys","handleAdd","curDetail","visibleAdd","submit","form","validateFields","console","log","handleEdit","edit","handleDelete","method","url","baseURL","_id","success","index","findIndex","x","splice","handleSelect","handleCancel","str","params","newDetail","name","handleUpdate","push","limit","fields","sortBy","createdAt","find","homeId","authUser","type","HOME","ADMIN","undefined","pharmacyId","PHARMACY","componentDidMount","render","mapStateToProps","auth"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAOC,iBAAP,MAA8B,0CAA9B;AACA,OAAOC,mBAAP,MAAgC,kCAAhC;AACA,OAAOC,KAAP,MAAkB,oCAAlB;AACA,SAASC,MAAT,EAAiBC,MAAjB,QAA+B,sCAA/B;AACA,SAASC,aAAT,QAA8B,mBAA9B;AACA,SAASC,KAAT,QAAsB,yBAAtB;AACA,SAASC,SAAT,EAAoBC,cAApB,QAA0C,sBAA1C;AAEA,IAAIC,eAAJ;;AACA,MAAMC,eAAN,SAA8BZ,SAA9B,CAAwC;AACpCa,EAAAA,WAAW,CAACC,KAAD,EAAQ;AAAA;;AACf,UAAMA,KAAN;;AADe,SA6BnBC,KA7BmB,GA6BX,YAAY;AAChB,WAAKC,QAAL,CAAc;AAAEC,QAAAA,UAAU,EAAE,KAAKC,KAAL,CAAWC,MAAX,CAAkBC,IAAlB,KAA2B,CAA3B,GAA+B,IAA/B,GAAsC;AAApD,OAAd;AACA,YAAMC,IAAI,GAAG;AAAEC,QAAAA,KAAK,EAAE,EAAE,GAAG,KAAKJ,KAAL,CAAWC;AAAhB;AAAT,OAAb;;AACA,UAAI;AACA,YAAII,GAAG,GAAG,MAAMnB,KAAK,CAAC,EAAE,GAAGC,MAAL;AAAagB,UAAAA;AAAb,SAAD,CAArB;;AACA,YAAIE,GAAJ,EAAS;AACL,cAAIA,GAAG,CAACC,IAAJ,KAAa,IAAjB,EAAuB;AACnB,gBAAIC,QAAQ,GAAG,KAAKP,KAAL,CAAWC,MAAX,CAAkBC,IAAlB,KAA2B,CAA3B,GAA+B,EAA/B,GAAoC,CAAC,GAAG,KAAKF,KAAL,CAAWO,QAAf,CAAnD;AACAA,YAAAA,QAAQ,GAAGA,QAAQ,CAACC,MAAT,CAAgBH,GAAG,CAACF,IAAJ,CAASA,IAAzB,CAAX;AACA,iBAAKL,QAAL,CAAc;AACVW,cAAAA,OAAO,EAAEF,QAAQ,CAACG,MAAT,KAAoBL,GAAG,CAACF,IAAJ,CAASQ,KAA7B,GAAqC,KAArC,GAA6C,IAD5C;AAEVC,cAAAA,OAAO,EAAE,KAFC;AAGVD,cAAAA,KAAK,EAAEN,GAAG,CAACF,IAAJ,CAASQ,KAHN;AAIVJ,cAAAA,QAAQ,EAAEA,QAJA;AAKVM,cAAAA,MAAM,EAAEN,QAAQ,CAACG,MAAT,GAAkB,CAAlB,GAAsBH,QAAQ,CAAC,CAAD,CAA9B,GAAoC;AALlC,aAAd;AAOH,WAVD,MAWIjB,KAAK,CAACwB,KAAN,CAAYT,GAAG,CAACU,OAAhB;AACP;;AACD,aAAKjB,QAAL,CAAc;AAAEC,UAAAA,UAAU,EAAE;AAAd,SAAd;AACH,OAjBD,CAiBE,MAAK;AACH,aAAKD,QAAL,CAAc;AAAEC,UAAAA,UAAU,EAAE,KAAd;AAAqBa,UAAAA,OAAO,EAAE;AAA9B,SAAd;AACH;AACJ,KApDkB;;AAAA,SAsDnBI,kBAtDmB,GAsDE,MAAM;AACvB,UAAIC,OAAO,GAAG,CAAC,GAAG,KAAKjB,KAAL,CAAWO,QAAf,CAAd;;AACA,UAAIU,OAAO,CAACP,MAAR,KAAmB,KAAKV,KAAL,CAAWW,KAAlC,EAAyC;AACrC,aAAKb,QAAL,CAAc;AAAEW,UAAAA,OAAO,EAAE;AAAX,SAAd;AACA;AACH;;AACD,WAAKX,QAAL,CAAc;AACVc,QAAAA,OAAO,EAAE,IADC;AAEVX,QAAAA,MAAM,EAAE,EACJ,GAAG,KAAKD,KAAL,CAAWC,MADV;AAEJC,UAAAA,IAAI,EAAE,KAAKF,KAAL,CAAWC,MAAX,CAAkBC,IAAlB,GAAyB;AAF3B;AAFE,OAAd,EAMG,MAAM,KAAKL,KAAL,EANT;AAOH,KAnEkB;;AAAA,SAqEnBqB,YArEmB,GAqEHC,KAAD,IAAW;AACtB,UAAI1B,eAAJ,EAAqB;AACjB2B,QAAAA,YAAY,CAAC3B,eAAD,CAAZ;AACAA,QAAAA,eAAe,GAAG,IAAlB;AACH;;AACDA,MAAAA,eAAe,GAAG4B,UAAU,CAAC,MAAM;AAC/B,aAAKvB,QAAL,CAAc;AACVG,UAAAA,MAAM,EAAE,EACJ,GAAG,KAAKD,KAAL,CAAWC,MADV;AAEJqB,YAAAA,MAAM,EAAE;AACJC,cAAAA,OAAO,EAAEJ,KADL;AAEJK,cAAAA,IAAI,EAAE,CAAC,MAAD;AAFF;AAFJ;AADE,SAAd,EAQG,MAAM,KAAK3B,KAAL,EART;AASH,OAV2B,EAUzB,GAVyB,CAA5B;AAWH,KArFkB;;AAAA,SAuFnB4B,SAvFmB,GAuFP,MAAM;AACd,WAAK3B,QAAL,CAAc;AAAE4B,QAAAA,SAAS,EAAE,EAAE,GAAG,KAAK1B,KAAL,CAAWa;AAAhB;AAAb,OAAd;AACA,WAAKf,QAAL,CAAc;AAAE6B,QAAAA,UAAU,EAAE,IAAd;AAAoBd,QAAAA,MAAM,EAAE;AAA5B,OAAd;AACH,KA1FkB;;AAAA,SA4FnBe,MA5FmB,GA4FV,MAAM;AACX,WAAKhC,KAAL,CAAWiC,IAAX,CAAgBC,cAAhB,CAA+B,CAAChB,KAAD,EAAQK,KAAR,KAAkB;AAC7CY,QAAAA,OAAO,CAACC,GAAR,CAAYlB,KAAZ,EAAmBK,KAAnB;AACH,OAFD;AAGH,KAhGkB;;AAAA,SAiGnBc,UAjGmB,GAiGLpB,MAAD,IAAY;AACrB,WAAKf,QAAL,CAAc;AAAE4B,QAAAA,SAAS,EAAE,EAAE,GAAGb;AAAL;AAAb,OAAd;AACA,WAAKf,QAAL,CAAc;AAAEoC,QAAAA,IAAI,EAAE,IAAR;AAAcP,QAAAA,UAAU,EAAE,IAA1B;AAAgCd,QAAAA;AAAhC,OAAd;AACH,KApGkB;;AAAA,SAqGnBsB,YArGmB,GAqGJ,MAAOhC,IAAP,IAAgB;AAC3B,WAAKL,QAAL,CAAc;AAAEC,QAAAA,UAAU,EAAE;AAAd,OAAd;AACA,YAAM;AAAEqC,QAAAA,MAAF;AAAUC,QAAAA,GAAV;AAAeC,QAAAA;AAAf,UAA2BlD,MAAjC;AACA,UAAIiB,GAAG,GAAG,MAAMnB,KAAK,CAAC;AAAEoD,QAAAA,OAAF;AAAWF,QAAAA,MAAX;AAAmBC,QAAAA,GAAG,EAAEA,GAAG,GAAGlC,IAAI,CAACoC;AAAnC,OAAD,CAArB;;AACA,UAAIlC,GAAG,IAAIA,GAAG,CAACC,IAAJ,KAAa,IAAxB,EAA8B;AAC1BhB,QAAAA,KAAK,CAACkD,OAAN,CAAcnC,GAAG,CAACU,OAAlB;AACA,YAAIR,QAAQ,GAAG,CAAC,GAAG,KAAKP,KAAL,CAAWO,QAAf,CAAf;AACA,YAAIkC,KAAK,GAAGlC,QAAQ,CAACmC,SAAT,CAAmBC,CAAC,IAAIA,CAAC,CAACJ,GAAF,KAAUpC,IAAI,CAACoC,GAAvC,CAAZ;AACA,YAAIE,KAAK,IAAI,CAAb,EACIlC,QAAQ,CAACqC,MAAT,CAAgBH,KAAhB,EAAuB,CAAvB;AACJ,aAAK3C,QAAL,CAAc;AAAES,UAAAA,QAAQ,EAAEA;AAAZ,SAAd;;AACA,YAAI,KAAKP,KAAL,CAAWa,MAAX,IAAsB,KAAKb,KAAL,CAAWa,MAAX,CAAkB0B,GAAlB,IAAyB,KAAKvC,KAAL,CAAWa,MAAX,CAAkB0B,GAAlB,KAA0BpC,IAAI,CAACoC,GAAlF,EAAwF,CACpF;AACH,SAFD,MAEO;AACH,eAAKzC,QAAL,CAAc;AACVe,YAAAA,MAAM,EAAEN,QAAQ,CAACG,MAAT,GAAkB,CAAlB,GAAsBH,QAAQ,CAAC,CAAD,CAA9B,GAAoC;AADlC,WAAd;AAGH;AACJ,OAdD,MAcO,IAAIF,GAAJ,EAAS;AACZf,QAAAA,KAAK,CAACwB,KAAN,CAAYT,GAAG,CAACU,OAAhB;AACH;;AACD,WAAKjB,QAAL,CAAc;AAAEC,QAAAA,UAAU,EAAE;AAAd,OAAd;AACH,KA3HkB;;AAAA,SA4HnB8C,YA5HmB,GA4HHhC,MAAD,IAAY;AACvB,WAAKf,QAAL,CAAc;AAAE6B,QAAAA,UAAU,EAAE,KAAd;AAAqBO,QAAAA,IAAI,EAAE,KAA3B;AAAkCrB,QAAAA;AAAlC,OAAd;AACH,KA9HkB;;AAAA,SA+HnBiC,YA/HmB,GA+HJ,CAACC,GAAD,EAAMC,MAAN,KAAiB;AAC5B,UAAIC,SAAS,GAAG,IAAhB;;AACA,UAAIF,GAAG,KAAK,KAAZ,EAAmB;AACfE,QAAAA,SAAS,GAAG,KAAKjD,KAAL,CAAWO,QAAX,CAAoB,CAApB,CAAZ;AACH,OAFD,MAEO,IAAI,KAAKP,KAAL,CAAW0B,SAAf,EAA0B;AAC7BuB,QAAAA,SAAS,GAAG,EACR,GAAG,KAAKjD,KAAL,CAAW0B,SADN;AAERwB,UAAAA,IAAI,EAAEF,MAAM,GAAGA,MAAM,CAACE,IAAV,GAAiB,KAAKlD,KAAL,CAAW0B,SAAX,CAAqBwB;AAF1C,SAAZ;AAIH;;AACD,WAAKpD,QAAL,CAAc;AACV6B,QAAAA,UAAU,EAAE,KADF;AACSO,QAAAA,IAAI,EAAE,KADf;AAEVrB,QAAAA,MAAM,EAAEoC;AAFE,OAAd;AAIH,KA7IkB;;AAAA,SA+InBE,YA/ImB,GA+IHH,MAAD,IAAY;AACvB,UAAId,IAAI,GAAG,KAAX;AACA,UAAI3B,QAAQ,GAAG,CAAC,GAAG,KAAKP,KAAL,CAAWO,QAAf,CAAf;AACA,UAAIkC,KAAK,GAAGlC,QAAQ,CAACmC,SAAT,CAAmBC,CAAC,IAAIA,CAAC,CAACJ,GAAF,KAAUS,MAAM,CAACT,GAAzC,CAAZ;;AACA,UAAIE,KAAK,IAAI,CAAb,EAAgB;AACZ;AACAP,QAAAA,IAAI,GAAG,IAAP;AACA3B,QAAAA,QAAQ,CAACkC,KAAD,CAAR,GAAkBO,MAAlB;AACH,OAJD,MAKIzC,QAAQ,CAAC6C,IAAT,CAAcJ,MAAd;;AACJzC,MAAAA,QAAQ,GAAGlB,aAAa,CAACkB,QAAD,EAAW,WAAX,CAAxB;AACA,WAAKT,QAAL,CAAc;AAAES,QAAAA,QAAQ,EAAEA;AAAZ,OAAd;AACA,WAAKuC,YAAL,CAAkBZ,IAAI,GAAG,MAAH,GAAY,KAAlC,EAAyCA,IAAI,GAAGc,MAAH,GAAY,IAAzD;AACH,KA5JkB;;AAEf,SAAKhD,KAAL,GAAa;AACT2B,MAAAA,UAAU,EAAE,KADH;AAET5B,MAAAA,UAAU,EAAE,KAFH;AAGTa,MAAAA,OAAO,EAAE,KAHA;AAITH,MAAAA,OAAO,EAAE,IAJA;AAKTyB,MAAAA,IAAI,EAAE,KALG;AAMTrB,MAAAA,MAAM,EAAE,IANC;AAOTN,MAAAA,QAAQ,EAAE,EAPD;AAQTI,MAAAA,KAAK,EAAE,CARE;AASTV,MAAAA,MAAM,EAAE;AACJC,QAAAA,IAAI,EAAE,CADF;AAEJmD,QAAAA,KAAK,EAAE,EAFH;AAGJC,QAAAA,MAAM,EAAE,CAAC,UAAD,EAAa,KAAb,EAAoB,MAApB,EAA4B,kBAA5B,EAAgD,WAAhD,CAHJ;AAIJC,QAAAA,MAAM,EAAE;AAAEC,UAAAA,SAAS,EAAE,CAAC;AAAd,SAJJ;AAKJC,QAAAA,IAAI,EAAE;AACFC,UAAAA,MAAM,EAAE9D,KAAK,CAAC+D,QAAN,CAAeC,IAAf,KAAwBrE,SAAS,CAACsE,IAAV,CAAeC,KAAvC,4BAA+ClE,KAAK,CAAC+D,QAAN,CAAeD,MAA9D,0DAA+C,sBAAuBnB,GAAtE,GAA4EwB,SADlF;AAEFC,UAAAA,UAAU,EAAEpE,KAAK,CAAC+D,QAAN,CAAeC,IAAf,KAAwBrE,SAAS,CAAC0E,QAAV,CAAmBH,KAA3C,4BAAmDlE,KAAK,CAAC+D,QAAN,CAAeK,UAAlE,0DAAmD,sBAA2BzB,GAA9E,GAAoFwB;AAF9F;AALF,OATC;AAmBTrC,MAAAA,SAAS,EAAE;AAnBF,KAAb;AAqBH;;AAEDwC,EAAAA,iBAAiB,GAAG;AAChB,SAAKrE,KAAL;AACH;;AAmIDsE,EAAAA,MAAM,GAAG;AACL,UAAM;AAAExC,MAAAA,UAAF;AAAcO,MAAAA,IAAd;AAAoBrB,MAAAA,MAApB;AAA4BN,MAAAA,QAA5B;AAAsCR,MAAAA,UAAtC;AAAkDU,MAAAA,OAAlD;AAA2DG,MAAAA;AAA3D,QAAuE,KAAKZ,KAAlF;AACA,UAAM;AAAE2D,MAAAA;AAAF,QAAe,KAAK/D,KAA1B;AACA,wBAAQ,uDACJ;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACI;AAAK,MAAA,SAAS,EAAC,oBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACI,oBAAC,iBAAD;AAAmB,MAAA,MAAM,EAAE,IAA3B;AACI,MAAA,KAAK,EAAE,KAAK6B,SADhB;AAC2B,MAAA,QAAQ,EAAElB,QADrC;AAEI,MAAA,MAAM,EAAE,KAAK0B,UAFjB;AAE6B,MAAA,QAAQ,EAAE,KAAKE,YAF5C;AAGI,MAAA,QAAQ,EAAE,KAAKU,YAHnB;AAII,MAAA,QAAQ,EAAE,KAAK3B,YAJnB;AAKI,MAAA,gBAAgB,EAAE,KAAKF,kBAL3B;AAK+C,MAAA,OAAO,EAAEP,OALxD;AAKiE,MAAA,OAAO,EAAEG,OAL1E;AAMI,MAAA,IAAI,EAAEsB,IANV;AAMgB,MAAA,MAAM,EAAErB,MANxB;AAMgC,MAAA,UAAU,EAAEd,UAN5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,eAQI,oBAAC,mBAAD;AAAqB,MAAA,UAAU,EAAE4B,UAAjC;AAA6C,MAAA,KAAK,EAAE,KAAKwB,YAAzD;AACI,MAAA,IAAI,EAAEjB,IADV;AACgB,MAAA,QAAQ,EAAE,KAAKY,YAD/B;AAC6C,MAAA,MAAM,EAAEjC,MADrD;AAEI,MAAA,QAAQ,EAAE8C,QAFd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MARJ,CADJ,CADI,CAAR;AAgBH;;AAlLmC;;AAoLxC,MAAMS,eAAe,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAc;AAClC,QAAM;AAAEV,IAAAA;AAAF,MAAeU,IAArB;AACA,SAAO;AACHV,IAAAA;AADG,GAAP;AAGH,CALD;;AAMA,eAAe5E,OAAO,CAACqF,eAAD,CAAP,CAAyB1E,eAAzB,CAAf;AAAyD","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux'\nimport PermissionSidebar from '../SubscriptionUpsert/components/SideBar';\nimport PermissionContainer from './components/PermissionContainer';\nimport axios from '../../services/api/services/common'\nimport { getAll, remove } from '../../services/api/routes/permission'\nimport { sortArrayDesc } from '../../util/common'\nimport { Toast } from '../../components/common';\nimport { USER_TYPE, isPharmacyUser } from '../../constants/User';\n\nlet delayDebounceFn\nclass RolePermissions extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            visibleAdd: false,\n            listLoader: false,\n            loading: false,\n            hasMore: true,\n            edit: false,\n            detail: null,\n            listData: [],\n            count: 0,\n            filter: {\n                page: 1,\n                limit: 15,\n                fields: ['isActive', '_id', 'name', 'groupPermissions', 'createdAt'],\n                sortBy: { createdAt: -1 },\n                find: {\n                    homeId: props.authUser.type === USER_TYPE.HOME.ADMIN ? props.authUser.homeId?._id : undefined,\n                    pharmacyId: props.authUser.type === USER_TYPE.PHARMACY.ADMIN ? props.authUser.pharmacyId?._id : undefined,\n                }\n            },\n            curDetail: null\n        };\n    }\n\n    componentDidMount() {\n        this.fetch()\n    }\n\n    fetch = async () => {\n        this.setState({ listLoader: this.state.filter.page === 1 ? true : false })\n        const data = { query: { ...this.state.filter } }\n        try {\n            let res = await axios({ ...getAll, data })\n            if (res) {\n                if (res.code === 'OK') {\n                    let listData = this.state.filter.page === 1 ? [] : [...this.state.listData]\n                    listData = listData.concat(res.data.data)\n                    this.setState({\n                        hasMore: listData.length === res.data.count ? false : true,\n                        loading: false,\n                        count: res.data.count,\n                        listData: listData,\n                        detail: listData.length > 0 ? listData[0] : null\n                    })\n                } else\n                    Toast.error(res.message)\n            }\n            this.setState({ listLoader: false })\n        } catch{\n            this.setState({ listLoader: false, loading: false })\n        }\n    }\n\n    handleInfiniteLoad = () => {\n        let tempArr = [...this.state.listData]\n        if (tempArr.length === this.state.count) {\n            this.setState({ hasMore: false })\n            return\n        }\n        this.setState({\n            loading: true,\n            filter: {\n                ...this.state.filter,\n                page: this.state.filter.page + 1\n            }\n        }, () => this.fetch())\n    }\n\n    handleSearch = (value) => {\n        if (delayDebounceFn) {\n            clearTimeout(delayDebounceFn)\n            delayDebounceFn = null\n        }\n        delayDebounceFn = setTimeout(() => {\n            this.setState({\n                filter: {\n                    ...this.state.filter,\n                    search: {\n                        keyword: value,\n                        keys: ['name'],\n                    }\n                }\n            }, () => this.fetch())\n        }, 600)\n    }\n\n    handleAdd = () => {\n        this.setState({ curDetail: { ...this.state.detail } })\n        this.setState({ visibleAdd: true, detail: null })\n    }\n\n    submit = () => {\n        this.props.form.validateFields((error, value) => {\n            console.log(error, value);\n        });\n    }\n    handleEdit = (detail) => {\n        this.setState({ curDetail: { ...detail } })\n        this.setState({ edit: true, visibleAdd: true, detail })\n    }\n    handleDelete = async (data) => {\n        this.setState({ listLoader: true })\n        const { method, url, baseURL } = remove\n        let res = await axios({ baseURL, method, url: url + data._id })\n        if (res && res.code === 'OK') {\n            Toast.success(res.message)\n            let listData = [...this.state.listData]\n            let index = listData.findIndex(x => x._id === data._id)\n            if (index >= 0)\n                listData.splice(index, 1)\n            this.setState({ listData: listData })\n            if (this.state.detail && (this.state.detail._id && this.state.detail._id !== data._id)) {\n                //stay as it is while delete\n            } else {\n                this.setState({\n                    detail: listData.length > 0 ? listData[0] : null\n                })\n            }\n        } else if (res) {\n            Toast.error(res.message)\n        }\n        this.setState({ listLoader: false })\n    }\n    handleSelect = (detail) => {\n        this.setState({ visibleAdd: false, edit: false, detail })\n    }\n    handleCancel = (str, params) => {\n        let newDetail = null\n        if (str === 'add') {\n            newDetail = this.state.listData[0]\n        } else if (this.state.curDetail) {\n            newDetail = {\n                ...this.state.curDetail,\n                name: params ? params.name : this.state.curDetail.name\n            }\n        }\n        this.setState({\n            visibleAdd: false, edit: false,\n            detail: newDetail\n        })\n    }\n\n    handleUpdate = (params) => {\n        let edit = false\n        let listData = [...this.state.listData]\n        let index = listData.findIndex(x => x._id === params._id)\n        if (index >= 0) {\n            //edit\n            edit = true\n            listData[index] = params\n        } else\n            listData.push(params)\n        listData = sortArrayDesc(listData, 'createdAt')\n        this.setState({ listData: listData })\n        this.handleCancel(edit ? 'edit' : 'add', edit ? params : null)\n    }\n\n    render() {\n        const { visibleAdd, edit, detail, listData, listLoader, hasMore, loading } = this.state\n        const { authUser } = this.props\n        return (<>\n            <div className=\"container\">\n                <div className=\"addpermission_wrap\">\n                    <PermissionSidebar isRole={true}\n                        onAdd={this.handleAdd} listData={listData}\n                        onEdit={this.handleEdit} onDelete={this.handleDelete}\n                        onSelect={this.handleSelect}\n                        onSearch={this.handleSearch}\n                        onInfiniteOnLoad={this.handleInfiniteLoad} hasMore={hasMore} loading={loading}\n                        edit={edit} detail={detail} listLoader={listLoader} />\n                    <PermissionContainer visibleAdd={visibleAdd} onAdd={this.handleUpdate}\n                        edit={edit} onCancel={this.handleCancel} detail={detail}\n                        authUser={authUser} />\n                </div>\n            </div>\n        </>);\n    }\n}\nconst mapStateToProps = ({ auth }) => {\n    const { authUser } = auth\n    return {\n        authUser\n    }\n}\nexport default connect(mapStateToProps)(RolePermissions);;"]},"metadata":{},"sourceType":"module"}