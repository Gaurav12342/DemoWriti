{"ast":null,"code":"var _jsxFileName = \"/home/gauravpendherkar/DemoWriti/src/containers/Permission/components/PermissionContainer.js\";\nimport React, { useState, useEffect } from 'react';\nimport AddSubscription from '../../SubscriptionUpsert/components/AddSubscription';\nimport PermissionList from './PermissionList';\nimport axios from '../../../services/api/services/common';\nimport { insert, get, update } from '../../../services/api/routes/permission';\nimport { PERMISSION_ACCESS_TYPE } from '../../../constants/subscription';\nimport { Spin, Toast } from '../../../components/common';\nimport PERMISSIONS from '../../../constants/roleBaseAccessPermission';\nimport { isModuleAccessible, canPerformAction } from '../../../util/common';\nimport { decryptData } from '../../../util/Crypto';\nimport { USER_TYPE } from '../../../constants/User';\n\nconst _ = require('lodash');\n\nconst Container = props => {\n  const {\n    visibleAdd,\n    onAdd,\n    edit,\n    onCancel,\n    detail,\n    authUser\n  } = props;\n  const [loader, setLoader] = useState(false);\n  const [saveLoader, setSaveLoader] = useState(false);\n  const [response, setResponse] = useState(null);\n  const [permissions, setPermissions] = useState([]);\n  const [isAll, setIsAll] = useState(false);\n  const mappedModule = decryptData(localStorage.getItem('mappedModulePermissions'));\n  let mappedSubModule = decryptData(localStorage.getItem('mappedSubModulePermissions'));\n  console.log(\"mappedModule\", mappedModule, mappedSubModule);\n  useEffect(() => {\n    console.log(\"--------------------------\");\n\n    if (visibleAdd && !edit) {\n      fetchJson();\n    }\n  }, [edit, visibleAdd]);\n  useEffect(() => {\n    if (detail) {\n      fetch();\n    }\n  }, [detail]);\n\n  const prepareData = listData => {\n    listData.forEach(x => {\n      x.isSelect = x.isSelect;\n\n      if (x.actions && x.actions.length) {\n        x.actions.forEach(act => {\n          act.isSelect = act.isSelect || false;\n\n          if (act.name) {\n            act.label = act.name;\n            delete act.name;\n          }\n        });\n      }\n\n      if (x.subModules && x.subModules.length) {\n        x.subModules = x.subModules.filter(y => {\n          let params = {\n            moduleId: x.module,\n            subModuleId: y.subModule\n          };\n\n          if (checkSubModulesFilter(y)) {\n            y.isSelect = y.isSelect;\n\n            if (y.actions && y.actions.length) {\n              y.actions.forEach(act => {\n                act.isSelect = act.isSelect || false;\n\n                if (act.name) {\n                  act.label = act.name;\n                  delete act.name;\n                }\n              });\n            }\n\n            return y;\n          }\n        });\n      }\n    });\n    listData = filterRoles(listData);\n    return listData;\n  };\n\n  const filterRoles = array => {\n    // filter roles according to assigned home\n    if (mappedModule) return array.filter(x => mappedModule[x.module] === PERMISSION_ACCESS_TYPE['DATA']);else return []; // else return array\n  };\n\n  const filterSubModuleRoles = array => {\n    // filter roles according to assigned home\n    if (mappedSubModule) return array.filter(x => mappedSubModule[x.subModule] === PERMISSION_ACCESS_TYPE['DATA']);else return [];\n  };\n\n  const checkSubModulesFilter = x => {\n    // submodule accessible or not\n    if (mappedSubModule) {\n      return mappedSubModule[x.subModule] === PERMISSION_ACCESS_TYPE['DATA'];\n    } else return false;\n  };\n\n  const fetchJson = () => {\n    let newData = _.cloneDeep(PERMISSIONS);\n\n    newData = prepareData(newData);\n    setResponse({\n      permissions: _.cloneDeep(newData)\n    });\n    setPermissions(_.cloneDeep(newData));\n  };\n\n  const fetch = async () => {\n    setLoader(true);\n    const {\n      method,\n      url,\n      baseURL\n    } = get;\n    let res = await axios({\n      baseURL,\n      method,\n      url: url + detail._id,\n      params: {\n        populate: true\n      }\n    });\n\n    if (res) {\n      if (res.code === 'OK') {\n        setResponse({ ...res.data\n        });\n        res.data.roleAccessPermissions = prepareData(res.data.roleAccessPermissions);\n        setPermissions(_.cloneDeep(res.data.roleAccessPermissions));\n      }\n    }\n\n    setLoader(false);\n  };\n\n  const handleSave = async params => {\n    var _authUser$homeId, _authUser$pharmacyId;\n\n    let exist = permissions.find(x => {\n      if (x.actions) {\n        return x.actions.find(act => act.isSelect);\n      }\n    });\n\n    if (!exist) {\n      Toast.error('Please select role permissions');\n      return;\n    }\n\n    setSaveLoader(true);\n    let groups = [];\n    permissions.forEach((mod, i) => {\n      if (mod.actions) {\n        mod.actions.forEach(x => {\n          x.name = x.label;\n          x.isSelect = x.isSelect || false;\n          delete x.label;\n          return x;\n        });\n      }\n\n      let obj = {\n        'module': mod.module,\n        'moduleName': mod.moduleName,\n        'actions': mod.actions || [],\n        // 'sequence': i + 1,\n        'isSelect': mod.isSelect || false,\n        'isActive': true,\n        \"subModules\": []\n      };\n\n      if (edit) {\n        obj['_id'] = mod['_id'];\n        obj.isActive = mod.isActive;\n        obj.subscriptionId = mod.subscriptionId;\n      }\n\n      if (mod.subModules && mod.subModules.length) {\n        mod.subModules.forEach(sub => {\n          if (sub.actions) {\n            sub.actions.forEach(x => {\n              x.name = x.label;\n              x.isSelect = x.isSelect || false;\n              delete x.label;\n              return x;\n            });\n          }\n\n          let subObj = {\n            \"subModule\": sub.subModule,\n            \"subModuleName\": sub.subModuleName,\n            'isSelect': sub.isSelect || false,\n            'actions': sub.actions || []\n          };\n\n          if (edit) {\n            subObj.isActive = sub.isActive;\n          }\n\n          obj.subModules.push(subObj);\n        });\n      }\n\n      groups.push(obj);\n    });\n    let {\n      method,\n      url,\n      baseURL\n    } = edit ? update : insert;\n    const data = { ...params,\n      isActive: true,\n      roleAccessPermissions: groups,\n      homeId: authUser.type === USER_TYPE.HOME.ADMIN ? (_authUser$homeId = authUser.homeId) === null || _authUser$homeId === void 0 ? void 0 : _authUser$homeId._id : undefined,\n      pharmacyId: authUser.type === USER_TYPE.PHARMACY.ADMIN ? (_authUser$pharmacyId = authUser.pharmacyId) === null || _authUser$pharmacyId === void 0 ? void 0 : _authUser$pharmacyId._id : undefined\n    };\n\n    if (edit) {\n      url = url + detail._id;\n    }\n\n    try {\n      let res = await axios({\n        baseURL,\n        method,\n        url,\n        data\n      });\n\n      if (res && res.code === 'OK') {\n        Toast.success(res.message);\n        setPermissions(res.data.roleAccessPermissions);\n        onAdd(res.data.subscriptionRoleGroup);\n      }\n\n      setSaveLoader(false);\n    } catch {\n      setSaveLoader(false);\n    }\n  };\n\n  const setSelection = (count, length) => {\n    if (count === 0) return false;else return true; // else if (count === length)\n    //     return true\n  };\n\n  const handlePermission = opt => {\n    let newPermissions = [...permissions];\n    newPermissions.forEach(x => {\n      if (x.module === opt.data.module) {\n        if (x.actions) {\n          let selectedActionCount = 0;\n          x.actions.forEach(act => {\n            if (act.code === opt.code) {\n              act.isSelect = !act.isSelect;\n            }\n\n            if (act.isSelect) selectedActionCount++;\n          });\n          x.isSelect = setSelection(selectedActionCount, x.actions.length);\n        }\n      } else if (x.module === opt.module) {\n        //submodule\n        if (x.subModules && x.subModules.length) {\n          x.subModules.forEach(y => {\n            if (y.subModule === opt.data.subModule) {\n              if (y.actions) {\n                let selectedActionCount = 0;\n                y.actions.forEach(act => {\n                  if (act.code === opt.code) {\n                    act.isSelect = !act.isSelect;\n                  }\n\n                  if (act.isSelect) selectedActionCount++;\n                });\n                y.isSelect = setSelection(selectedActionCount, y.actions.length);\n              }\n            }\n          });\n        }\n      }\n    });\n    setPermissions(newPermissions);\n  };\n\n  const handleSelection = opt => {\n    let newPermissions = [...permissions];\n    newPermissions.forEach(x => {\n      if (x.module === opt.module) {\n        if (x.subModules && x.subModules.length) {\n          //submodule\n          x.subModules.forEach(y => {\n            if (y.subModule === opt.data.subModule) {\n              y.isSelect = !y.isSelect;\n\n              if (y.actions) {\n                y.actions.forEach(act => {\n                  act.isSelect = y.isSelect ? true : false;\n                  return act;\n                });\n              }\n            }\n          });\n        }\n      } else if (x.module === opt.data.module) {\n        x.isSelect = !x.isSelect;\n\n        if (x.actions) {\n          x.actions.forEach(act => {\n            act.isSelect = x.isSelect ? true : false;\n            return act;\n          });\n        }\n      }\n    });\n    setPermissions(newPermissions);\n  };\n\n  const handleCancel = () => {\n    setPermissions(response.permissions);\n    onCancel();\n  };\n\n  const handleSelectAll = e => {\n    //handle select/de-select all permisisons\n    let checked = e.target.checked;\n    setIsAll(checked);\n    let newPermissions = [...permissions];\n    newPermissions.forEach(x => {\n      x.isSelect = checked;\n\n      if (x.actions) {\n        x.actions.forEach(act => {\n          act.isSelect = checked;\n          return act;\n        });\n      }\n\n      if (x.subModules && x.subModules.length) {\n        //submodule\n        x.subModules.forEach(y => {\n          y.isSelect = checked;\n\n          if (y.actions) {\n            y.actions.forEach(act => {\n              act.isSelect = checked;\n              return act;\n            });\n          }\n        });\n      }\n    });\n    setPermissions(newPermissions);\n  };\n\n  const handleSortEnd = mod => {\n    let newGroupPermissions = [...permissions];\n    newGroupPermissions.map(x => {\n      if (x.module === mod.module) return mod;else return x;\n    });\n    setPermissions(newGroupPermissions);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, loader ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"permission_part_nodata\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 22\n    }\n  }, /*#__PURE__*/React.createElement(Spin, {\n    spinning: loader,\n    str: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 62\n    }\n  })) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"permission_part\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 17\n    }\n  }, visibleAdd ? /*#__PURE__*/React.createElement(AddSubscription, {\n    isRole: true,\n    onSave: handleSave,\n    onCancel: handleCancel,\n    loading: saveLoader,\n    edit: edit,\n    detail: detail,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 25\n    }\n  }) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"permission_label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 27\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 29\n    }\n  }, permissions && permissions.length > 0 ? detail && detail.name || 'Permission' : '')), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"permission_tab_wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 21\n    }\n  }, permissions && permissions.length > 0 ? /*#__PURE__*/React.createElement(PermissionList, {\n    listData: permissions,\n    saveLoader: saveLoader,\n    onSetPermission: handlePermission,\n    onSelection: handleSelection,\n    detail: detail,\n    visibleAdd: visibleAdd,\n    onSelectAll: handleSelectAll,\n    onSortEnd: handleSortEnd,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 33\n    }\n  }) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"permissions_list_wrap text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 35\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 37\n    }\n  }, \" No role permissions found. Please Add Role Permission.\")))));\n};\n\nexport default Container;","map":{"version":3,"sources":["/home/gauravpendherkar/DemoWriti/src/containers/Permission/components/PermissionContainer.js"],"names":["React","useState","useEffect","AddSubscription","PermissionList","axios","insert","get","update","PERMISSION_ACCESS_TYPE","Spin","Toast","PERMISSIONS","isModuleAccessible","canPerformAction","decryptData","USER_TYPE","_","require","Container","props","visibleAdd","onAdd","edit","onCancel","detail","authUser","loader","setLoader","saveLoader","setSaveLoader","response","setResponse","permissions","setPermissions","isAll","setIsAll","mappedModule","localStorage","getItem","mappedSubModule","console","log","fetchJson","fetch","prepareData","listData","forEach","x","isSelect","actions","length","act","name","label","subModules","filter","y","params","moduleId","module","subModuleId","subModule","checkSubModulesFilter","filterRoles","array","filterSubModuleRoles","newData","cloneDeep","method","url","baseURL","res","_id","populate","code","data","roleAccessPermissions","handleSave","exist","find","error","groups","mod","i","obj","moduleName","isActive","subscriptionId","sub","subObj","subModuleName","push","homeId","type","HOME","ADMIN","undefined","pharmacyId","PHARMACY","success","message","subscriptionRoleGroup","setSelection","count","handlePermission","opt","newPermissions","selectedActionCount","handleSelection","handleCancel","handleSelectAll","e","checked","target","handleSortEnd","newGroupPermissions","map"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport AddSubscription from '../../SubscriptionUpsert/components/AddSubscription'\nimport PermissionList from './PermissionList'\nimport axios from '../../../services/api/services/common'\nimport { insert, get, update } from '../../../services/api/routes/permission'\nimport { PERMISSION_ACCESS_TYPE } from '../../../constants/subscription'\nimport { Spin, Toast } from '../../../components/common'\nimport PERMISSIONS from '../../../constants/roleBaseAccessPermission'\nimport { isModuleAccessible, canPerformAction } from '../../../util/common'\nimport { decryptData } from '../../../util/Crypto';\nimport { USER_TYPE } from '../../../constants/User';\nconst _ = require('lodash')\n\nconst Container = props => {\n    const { visibleAdd, onAdd, edit, onCancel, detail, authUser } = props\n    const [loader, setLoader] = useState(false)\n    const [saveLoader, setSaveLoader] = useState(false)\n    const [response, setResponse] = useState(null)\n    const [permissions, setPermissions] = useState([])\n    const [isAll, setIsAll] = useState(false)\n\n    const mappedModule = decryptData(localStorage.getItem('mappedModulePermissions'))\n    let mappedSubModule = decryptData(localStorage.getItem('mappedSubModulePermissions'))\n    console.log(\"mappedModule\", mappedModule, mappedSubModule)\n\n    useEffect(() => {\n        console.log(\"--------------------------\")\n        if ((visibleAdd) && !edit) {\n            fetchJson()\n        }\n    }, [edit, visibleAdd])\n\n    useEffect(() => {\n        if (detail) {\n            fetch()\n        }\n    }, [detail])\n\n    const prepareData = (listData) => {\n        listData.forEach(x => {\n            x.isSelect = x.isSelect\n            if (x.actions && x.actions.length) {\n                x.actions.forEach(act => {\n                    act.isSelect = act.isSelect || false\n                    if (act.name) {\n                        act.label = act.name\n                        delete act.name\n                    }\n                })\n            }\n            if (x.subModules && x.subModules.length) {\n                x.subModules = x.subModules.filter(y => {\n                    let params = {\n                        moduleId: x.module,\n                        subModuleId: y.subModule,\n                    }\n                    if (checkSubModulesFilter(y)) {\n                        y.isSelect = y.isSelect\n                        if (y.actions && y.actions.length) {\n                            y.actions.forEach(act => {\n                                act.isSelect = act.isSelect || false\n                                if (act.name) {\n                                    act.label = act.name\n                                    delete act.name\n                                }\n                            })\n                        }\n                        return y\n                    }\n                })\n\n            }\n        })\n        listData = filterRoles(listData)\n        return listData\n    }\n\n    const filterRoles = (array) => {\n        // filter roles according to assigned home\n        if (mappedModule)\n            return array.filter(x => mappedModule[x.module] === PERMISSION_ACCESS_TYPE['DATA'])\n        else return []\n        // else return array\n    }\n\n    const filterSubModuleRoles = (array) => {\n        // filter roles according to assigned home\n        if (mappedSubModule)\n            return array.filter(x => mappedSubModule[x.subModule] === PERMISSION_ACCESS_TYPE['DATA'])\n        else return []\n    }\n\n    const checkSubModulesFilter = (x) => {\n        // submodule accessible or not\n        if (mappedSubModule) {\n            return mappedSubModule[x.subModule] === PERMISSION_ACCESS_TYPE['DATA']\n        }\n        else return false\n    }\n\n    const fetchJson = () => {\n        let newData = _.cloneDeep(PERMISSIONS)\n        newData = prepareData(newData)\n        setResponse({ permissions: _.cloneDeep(newData) })\n        setPermissions(_.cloneDeep(newData))\n    }\n\n    const fetch = async () => {\n        setLoader(true)\n        const { method, url, baseURL } = get\n        let res = await axios({ baseURL, method, url: url + detail._id, params: { populate: true } })\n        if (res) {\n            if (res.code === 'OK') {\n                setResponse({ ...res.data })\n                res.data.roleAccessPermissions = prepareData(res.data.roleAccessPermissions)\n                setPermissions(_.cloneDeep(res.data.roleAccessPermissions))\n            }\n        }\n        setLoader(false)\n    }\n\n    const handleSave = async (params) => {\n        let exist = permissions.find(x => {\n            if (x.actions) {\n                return x.actions.find(act => act.isSelect)\n            }\n        })\n        if (!exist) {\n            Toast.error('Please select role permissions')\n            return\n        }\n        setSaveLoader(true)\n        let groups = []\n        permissions.forEach((mod, i) => {\n            if (mod.actions) {\n                mod.actions.forEach((x) => {\n                    x.name = x.label\n                    x.isSelect = x.isSelect || false\n                    delete x.label\n                    return x\n                })\n            }\n            let obj = {\n                'module': mod.module,\n                'moduleName': mod.moduleName,\n                'actions': mod.actions || [],\n                // 'sequence': i + 1,\n                'isSelect': mod.isSelect || false,\n                'isActive': true,\n                \"subModules\": []\n            }\n            if (edit) {\n                obj['_id'] = mod['_id']\n                obj.isActive = mod.isActive\n                obj.subscriptionId = mod.subscriptionId\n            }\n            if (mod.subModules && mod.subModules.length) {\n                mod.subModules.forEach(sub => {\n                    if (sub.actions) {\n                        sub.actions.forEach((x) => {\n                            x.name = x.label\n                            x.isSelect = x.isSelect || false\n                            delete x.label\n                            return x\n                        })\n                    }\n                    let subObj = {\n                        \"subModule\": sub.subModule,\n                        \"subModuleName\": sub.subModuleName,\n                        'isSelect': sub.isSelect || false,\n                        'actions': sub.actions || [],\n                    }\n                    if (edit) {\n                        subObj.isActive = sub.isActive\n                    }\n                    obj.subModules.push(subObj)\n                })\n            }\n            groups.push(obj)\n        })\n        let { method, url, baseURL } = edit ? update : insert\n        const data = {\n            ...params,\n            isActive: true,\n            roleAccessPermissions: groups,\n            homeId: authUser.type === USER_TYPE.HOME.ADMIN ? authUser.homeId?._id : undefined,\n            pharmacyId: authUser.type === USER_TYPE.PHARMACY.ADMIN ? authUser.pharmacyId?._id : undefined,\n        }\n\n        if (edit) {\n            url = url + detail._id\n        }\n        try {\n            let res = await axios({ baseURL, method, url, data })\n            if (res && res.code === 'OK') {\n                Toast.success(res.message)\n                setPermissions(res.data.roleAccessPermissions)\n                onAdd(res.data.subscriptionRoleGroup)\n            }\n            setSaveLoader(false)\n        } catch{\n            setSaveLoader(false)\n        }\n    }\n\n    const setSelection = (count, length) => {\n        if (count === 0)\n            return false\n        else return true\n        // else if (count === length)\n        //     return true\n    }\n\n    const handlePermission = opt => {\n        let newPermissions = [...permissions]\n        newPermissions.forEach(x => {\n            if (x.module === opt.data.module) {\n                if (x.actions) {\n                    let selectedActionCount = 0\n                    x.actions.forEach(act => {\n                        if (act.code === opt.code) {\n                            act.isSelect = !act.isSelect\n                        }\n                        if (act.isSelect)\n                            selectedActionCount++\n                    })\n                    x.isSelect = setSelection(selectedActionCount, x.actions.length)\n                }\n            } else if (x.module === opt.module) {\n                //submodule\n                if (x.subModules && x.subModules.length) {\n                    x.subModules.forEach(y => {\n                        if (y.subModule === opt.data.subModule) {\n                            if (y.actions) {\n                                let selectedActionCount = 0\n                                y.actions.forEach(act => {\n                                    if (act.code === opt.code) {\n                                        act.isSelect = !act.isSelect\n                                    }\n                                    if (act.isSelect)\n                                        selectedActionCount++\n                                })\n                                y.isSelect = setSelection(selectedActionCount, y.actions.length)\n                            }\n                        }\n                    })\n                }\n            }\n        })\n        setPermissions(newPermissions)\n    }\n    const handleSelection = opt => {\n        let newPermissions = [...permissions]\n        newPermissions.forEach(x => {\n            if (x.module === opt.module) {\n                if (x.subModules && x.subModules.length) {\n                    //submodule\n                    x.subModules.forEach(y => {\n                        if (y.subModule === opt.data.subModule) {\n                            y.isSelect = !y.isSelect\n                            if (y.actions) {\n                                y.actions.forEach(act => {\n                                    act.isSelect = y.isSelect ? true : false\n                                    return act\n                                })\n                            }\n                        }\n                    })\n                }\n            }\n            else if (x.module === opt.data.module) {\n                x.isSelect = !x.isSelect\n                if (x.actions) {\n                    x.actions.forEach(act => {\n                        act.isSelect = x.isSelect ? true : false\n                        return act\n                    })\n                }\n            }\n        })\n        setPermissions(newPermissions)\n    }\n\n    const handleCancel = () => {\n        setPermissions(response.permissions)\n        onCancel()\n    }\n\n    const handleSelectAll = (e) => {\n        //handle select/de-select all permisisons\n        let checked = e.target.checked\n        setIsAll(checked)\n        let newPermissions = [...permissions]\n        newPermissions.forEach(x => {\n            x.isSelect = checked\n            if (x.actions) {\n                x.actions.forEach(act => {\n                    act.isSelect = checked\n                    return act\n                })\n            }\n            if (x.subModules && x.subModules.length) {\n                //submodule\n                x.subModules.forEach(y => {\n                    y.isSelect = checked\n                    if (y.actions) {\n                        y.actions.forEach(act => {\n                            act.isSelect = checked\n                            return act\n                        })\n                    }\n                })\n            }\n        })\n        setPermissions(newPermissions)\n    }\n\n    const handleSortEnd = (mod) => {\n        let newGroupPermissions = [...permissions]\n        newGroupPermissions.map(x => {\n            if (x.module === mod.module)\n                return mod\n            else return x\n        })\n        setPermissions(newGroupPermissions)\n    }\n\n    return (<>\n        {\n            loader ? <div className='permission_part_nodata'><Spin spinning={loader} str='center' /></div>\n                :\n                <div className='permission_part'>\n                    {visibleAdd ?\n                        <AddSubscription isRole={true}\n                            onSave={handleSave} onCancel={handleCancel}\n                            loading={saveLoader} edit={edit} detail={detail} />\n                        : <div className='permission_label'>\n                            <h4>{\n                                permissions && permissions.length > 0 ?\n                                    ((detail && detail.name) || 'Permission') : ''\n                            }</h4>\n                        </div>\n                    }\n                    <div className='permission_tab_wrap'>\n                        {\n                            permissions && permissions.length > 0 ?\n                                <PermissionList listData={permissions}\n                                    saveLoader={saveLoader}\n                                    onSetPermission={handlePermission}\n                                    onSelection={handleSelection}\n                                    detail={detail}\n                                    visibleAdd={visibleAdd}\n                                    onSelectAll={handleSelectAll}\n                                    onSortEnd={handleSortEnd}\n                                />\n                                : <div className=\"permissions_list_wrap text-center\">\n                                    <strong> No role permissions found. Please Add Role Permission.</strong>\n                                </div>\n                        }\n                    </div>\n                </div>\n\n        }\n    </>);\n}\nexport default Container;"]},"metadata":{},"sourceType":"module"}