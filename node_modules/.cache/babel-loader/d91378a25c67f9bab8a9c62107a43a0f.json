{"ast":null,"code":"var _jsxFileName = \"/home/gauravpendherkar/DemoWriti/src/containers/PCC/components/MappingModal.js\";\nimport React, { useState, memo, useEffect } from 'react';\nimport { Dialog, Button, Select, Option, ErrorMsg, Toast, Input } from '../../../components/common';\nimport HomeAreaFilter from '../../../components/HomeAreaFilter';\nimport { createForm } from 'rc-form';\nimport { getPccList, mapPcc } from '../../../services/api/routes/pcc';\nimport { getAllHomeArea } from '../../../services/api/routes/customer';\nimport axios from '../../../services/api/services/common';\n\nconst _ = require('lodash');\n\nconst ADD_TYEPS = {\n  NEW: 1,\n  ADD_IN_EXISTING: 2\n};\n\nconst MappingModal = props => {\n  const {\n    visible,\n    detail,\n    onCancel,\n    form,\n    authUser,\n    onOk\n  } = props;\n  const {\n    getFieldError,\n    getFieldDecorator,\n    getFieldValue,\n    validateFields\n  } = form;\n  const [addAs, setAddAs] = useState();\n  const [homeLoader, setHomeLoader] = useState(false);\n  const [loader, setLoader] = useState(false);\n  const [okLoader, setOkLoader] = useState(false);\n  const [floors, setFloors] = useState([]);\n  const [homeAreas, setHomeAreas] = useState([]);\n  const {\n    homeList\n  } = authUser;\n  const [homeareaSelectedFilter, setHomeareaSelectedFilter] = useState({});\n  let errors;\n  useEffect(() => {\n    fetchFloor();\n  }, []);\n\n  const handleChangeAddAs = e => {\n    setAddAs(parseInt(e.target.value));\n  };\n\n  const handleChangeHome = val => {\n    if (val) {\n      const homeDetails = _.find(homeList, {\n        _id: val\n      });\n\n      fetchHomeArea(val, {\n        homeId: val,\n        homeIdentifier: homeDetails.homeIdentifier,\n        isCustom: true\n      });\n    }\n  };\n\n  const fetchFloor = async () => {\n    let filter = {\n      fields: [],\n      find: {\n        facId: detail.facId\n      }\n    };\n    setLoader(true);\n\n    try {\n      let res = await axios({ ...getPccList,\n        data: {\n          query: filter\n        }\n      });\n\n      if (res) {\n        if (res.code === 'OK') {\n          res.data.data = res.data.data.filter(obj => obj.floorId);\n          setFloors(res.data.data);\n        } else {\n          Toast.error(res.message);\n        }\n      }\n\n      setLoader(false);\n    } catch {\n      setLoader(false);\n    }\n  };\n\n  const handleChangeInSelectHomearea = (val1, val2, index) => {\n    if (val1) {\n      setHomeAreas(oldState => {\n        const temp = _.filter(oldState, d => d._id !== val1);\n\n        console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 72 ~ handleChangeInSelectHomearea ~ temp\", temp);\n        return temp;\n      });\n    }\n\n    console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 80 ~ handleChangeInSelectHomearea ~ homeareaSelectedFilter\", homeareaSelectedFilter);\n\n    if (getFieldValue(\"homeArea\" + index)) {\n      const temp = _.filter(homeareaSelectedFilter, d => d._id === getFieldValue(\"homeArea\" + index));\n\n      console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 78 ~ handleChangeInSelectHomearea ~ temp IN DELECT\", temp);\n      setHomeAreas(oldState => {\n        console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 81 ~ handleChangeInSelectHomearea ~ oldState\", oldState);\n\n        const temp2 = _.concat(oldState, temp);\n\n        console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 82 ~ handleChangeInSelectHomearea ~ temp2\", temp2);\n        return temp2;\n      });\n    } // console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 68 ~ handleChangeInSelectHomearea ~ val\", index, val1, val2)\n    // console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 72 ~ handleChangeInSelectHomearea ~ \", getFieldValue(\"homeArea\" + index))\n\n  };\n\n  const fetchHomeArea = async (val, headers) => {\n    console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 92 ~ fetchHomeArea ~ headers\", headers);\n    setLoader(true);\n    const request = {\n      fields: ['isActive', 'name'],\n      find: {\n        isActive: true\n      }\n    };\n\n    try {\n      let res = await axios({ ...getAllHomeArea,\n        headers,\n        data: {\n          query: request\n        }\n      });\n\n      if (res && res.code === 'OK') {\n        setHomeAreas(res.data.data);\n        setHomeareaSelectedFilter(res.data.data);\n      }\n\n      setLoader(false);\n    } catch {\n      setLoader(false);\n    }\n  };\n\n  const handleOk = () => {\n    validateFields(async (err, values) => {\n      if (err) {\n        return;\n      }\n\n      if (!addAs) return Toast.error('Please select any facility for mapping');\n      let request = {};\n\n      if (addAs === ADD_TYEPS['NEW']) {\n        detail.assignedSubscriptionGroupId = authUser.homeId.assignedSubscriptionGroupId._id;\n        delete detail._id;\n        request = {\n          home: detail,\n          homeareas: floors\n        };\n      } else {\n        let newHAData = [];\n        floors.map(k => {\n          if (values[`homeArea${k.floorId}`]) {\n            delete k._id;\n            newHAData.push({\n              homeAreaId: values[`homeArea${k.floorId}`],\n              ...k\n            });\n          }\n        });\n        request = {\n          homeId: values.homeId,\n          home: _.omit(detail, '_id'),\n          homeareas: newHAData\n        };\n      }\n\n      setOkLoader(true);\n\n      try {\n        let res = await axios({ ...mapPcc,\n          data: request\n        });\n\n        if (res) {\n          if (res.code === 'OK') {\n            Toast.success(res.message);\n            onOk();\n          } else Toast.error(res.message);\n        }\n\n        setOkLoader(false);\n      } catch {\n        setOkLoader(false);\n      }\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Dialog, {\n    visible: visible,\n    title: detail.facilityName,\n    onCancel: onCancel,\n    onOk: handleOk,\n    okButtonProps: {\n      loading: okLoader\n    },\n    width: 650,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form_row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    className: \"filter_check\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"checkbox\",\n    name: \"type\",\n    value: ADD_TYEPS.NEW,\n    checked: addAs === ADD_TYEPS.NEW,\n    onChange: handleChangeAddAs,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"checkbox radio\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"lbl\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 29\n    }\n  }, \"Add as New facility in Writi\")))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    className: \"filter_check\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"checkbox\",\n    name: \"type\",\n    value: ADD_TYEPS.ADD_IN_EXISTING,\n    checked: addAs === ADD_TYEPS.ADD_IN_EXISTING,\n    onChange: handleChangeAddAs,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"checkbox radio\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"lbl\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 29\n    }\n  }, \"Map with Existing facility in Writi\")))), addAs === ADD_TYEPS['ADD_IN_EXISTING'] ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form_group col-12 required\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 29\n    }\n  }, \"Writi Home\", /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 46\n    }\n  }, \"*\")), getFieldDecorator('homeId', {\n    rules: [{\n      required: true\n    }]\n  })( /*#__PURE__*/React.createElement(Select, {\n    placeholder: \"Select Home\",\n    loading: homeLoader,\n    showSearch: true,\n    onChange: handleChangeHome,\n    allowClear: true,\n    filterOption: (input, option) => option.props.children.toLowerCase().indexOf(input.toLowerCase()) >= 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 33\n    }\n  }, homeList.map(curObj => {\n    return /*#__PURE__*/React.createElement(Option, {\n      key: curObj._id,\n      value: curObj._id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 45\n      }\n    }, curObj.name);\n  }))), (errors = getFieldError('homeId')) ? /*#__PURE__*/React.createElement(ErrorMsg, {\n    errors: errors,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 33\n    }\n  }) : null), floors.map((floor, index) => {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form_group col-6 required\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 41\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 45\n      }\n    }, \"PointClickCare Floor\", /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 72\n      }\n    }, \"*\")), /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 45\n      }\n    }, floor.floorDesc)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form_group col-6 required\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 41\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 45\n      }\n    }, \"Writi Home Area\", /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 67\n      }\n    }, \"*\")), getFieldDecorator('homeArea' + floor.floorId, {\n      rules: [{\n        required: true\n      }]\n    })( /*#__PURE__*/React.createElement(Select, {\n      loading: loader,\n      placeholder: \"Select Home Area\",\n      showSearch: true,\n      allowClear: true,\n      filterOption: (input, option) => option.props.children.toLowerCase().indexOf(input.toLowerCase()) >= 0 // onChange={(val1, val2) => handleChangeInSelectHomearea(val1, val2, floor.floorId)}\n      // onDeselect={handleChangeInSelectHomearea}\n      ,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 49\n      }\n    }, homeAreas.length > 0 ? homeAreas.map(curObj => {\n      return /*#__PURE__*/React.createElement(Option, {\n        key: curObj._id,\n        value: curObj._id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 65\n        }\n      }, curObj.name);\n    }) : null)), (errors = getFieldError('homeArea')) ? /*#__PURE__*/React.createElement(ErrorMsg, {\n      errors: errors,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 49\n      }\n    }) : null));\n  })) : null)));\n};\n\nexport default memo(createForm()(MappingModal));","map":{"version":3,"sources":["/home/gauravpendherkar/DemoWriti/src/containers/PCC/components/MappingModal.js"],"names":["React","useState","memo","useEffect","Dialog","Button","Select","Option","ErrorMsg","Toast","Input","HomeAreaFilter","createForm","getPccList","mapPcc","getAllHomeArea","axios","_","require","ADD_TYEPS","NEW","ADD_IN_EXISTING","MappingModal","props","visible","detail","onCancel","form","authUser","onOk","getFieldError","getFieldDecorator","getFieldValue","validateFields","addAs","setAddAs","homeLoader","setHomeLoader","loader","setLoader","okLoader","setOkLoader","floors","setFloors","homeAreas","setHomeAreas","homeList","homeareaSelectedFilter","setHomeareaSelectedFilter","errors","fetchFloor","handleChangeAddAs","e","parseInt","target","value","handleChangeHome","val","homeDetails","find","_id","fetchHomeArea","homeId","homeIdentifier","isCustom","filter","fields","facId","res","data","query","code","obj","floorId","error","message","handleChangeInSelectHomearea","val1","val2","index","oldState","temp","d","console","log","temp2","concat","headers","request","isActive","handleOk","err","values","assignedSubscriptionGroupId","home","homeareas","newHAData","map","k","push","homeAreaId","omit","success","facilityName","loading","rules","required","input","option","children","toLowerCase","indexOf","curObj","name","floor","floorDesc","length"],"mappings":"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","sourcesContent":["import React, { useState, memo, useEffect } from 'react';\nimport { Dialog, Button, Select, Option, ErrorMsg, Toast, Input } from '../../../components/common';\nimport HomeAreaFilter from '../../../components/HomeAreaFilter'\nimport { createForm } from 'rc-form';\nimport {\n    getPccList,\n    mapPcc\n} from '../../../services/api/routes/pcc';\nimport { getAllHomeArea } from '../../../services/api/routes/customer';\nimport axios from '../../../services/api/services/common';\nconst _ = require('lodash')\n\nconst ADD_TYEPS = {\n    NEW: 1,\n    ADD_IN_EXISTING: 2\n}\n\nconst MappingModal = props => {\n    const { visible, detail, onCancel, form, authUser, onOk } = props\n    const {\n        getFieldError, getFieldDecorator, getFieldValue, validateFields\n    } = form;\n    const [addAs, setAddAs] = useState()\n    const [homeLoader, setHomeLoader] = useState(false)\n    const [loader, setLoader] = useState(false)\n    const [okLoader, setOkLoader] = useState(false)\n    const [floors, setFloors] = useState([])\n    const [homeAreas, setHomeAreas] = useState([])\n    const { homeList } = authUser\n    const [homeareaSelectedFilter, setHomeareaSelectedFilter] = useState({})\n    let errors\n\n    useEffect(() => {\n        fetchFloor()\n    }, [])\n\n    const handleChangeAddAs = (e) => {\n        setAddAs(parseInt(e.target.value))\n    }\n\n    const handleChangeHome = (val) => {\n        if(val){\n            const homeDetails = _.find(homeList, { _id: val })\n            fetchHomeArea(val, { homeId: val, homeIdentifier: homeDetails.homeIdentifier, isCustom: true })\n        }\n    }\n\n    const fetchFloor = async () => {\n        let filter = {\n            fields: [],\n            find: { facId: detail.facId }\n        }\n        setLoader(true)\n        try {\n            let res = await axios({ ...getPccList, data: { query: filter } })\n            if (res) {\n                if (res.code === 'OK') {\n                    res.data.data = res.data.data.filter(obj => obj.floorId)\n                    setFloors(res.data.data)\n                } else {\n                    Toast.error(res.message)\n                }\n            }\n            setLoader(false)\n        } catch {\n            setLoader(false)\n        }\n    }\n\n    const handleChangeInSelectHomearea = (val1, val2, index) => {\n        if (val1) {\n            setHomeAreas(oldState => {\n                const temp = _.filter(oldState, d => d._id !== val1)\n                console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 72 ~ handleChangeInSelectHomearea ~ temp\", temp)\n                return temp\n            })\n        }\n        console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 80 ~ handleChangeInSelectHomearea ~ homeareaSelectedFilter\", homeareaSelectedFilter)\n        if (getFieldValue(\"homeArea\" + index)) {\n            const temp = _.filter(homeareaSelectedFilter, d => d._id === getFieldValue(\"homeArea\" + index))\n            console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 78 ~ handleChangeInSelectHomearea ~ temp IN DELECT\", temp)\n            setHomeAreas(oldState => {\n                console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 81 ~ handleChangeInSelectHomearea ~ oldState\", oldState)\n                const temp2 = _.concat(oldState, temp)\n                console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 82 ~ handleChangeInSelectHomearea ~ temp2\", temp2)\n                return temp2\n            })\n        }\n        // console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 68 ~ handleChangeInSelectHomearea ~ val\", index, val1, val2)\n        // console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 72 ~ handleChangeInSelectHomearea ~ \", getFieldValue(\"homeArea\" + index))\n    }\n\n    const fetchHomeArea = async (val, headers) => {\n        console.log(\"ðŸš€ ~ file: MappingModal.js ~ line 92 ~ fetchHomeArea ~ headers\", headers)\n        setLoader(true)\n        const request = {\n            fields: ['isActive', 'name'],\n            find: { isActive: true }\n        }\n        try {\n            let res = await axios({ ...getAllHomeArea, headers, data: { query: request } })\n            if (res && res.code === 'OK') {\n                setHomeAreas(res.data.data)\n                setHomeareaSelectedFilter(res.data.data)\n            }\n            setLoader(false)\n        } catch {\n            setLoader(false)\n        }\n    }\n\n    const handleOk = () => {\n        validateFields(async (err, values) => {\n            if (err) {\n                return\n            }\n            if (!addAs)\n                return Toast.error('Please select any facility for mapping')\n\n            let request = {}\n            if (addAs === ADD_TYEPS['NEW']) {\n                detail.assignedSubscriptionGroupId = authUser.homeId.assignedSubscriptionGroupId._id\n                delete detail._id\n                request = {\n                    home: detail,\n                    homeareas: floors\n                }\n            } else {\n                let newHAData = []\n                floors.map(k => {\n                    if (values[`homeArea${k.floorId}`]) {\n                        delete k._id\n                        newHAData.push({\n                            homeAreaId: values[`homeArea${k.floorId}`],\n                            ...k\n                        })\n                    }\n                })\n                request = {\n                    homeId: values.homeId,\n                    home: _.omit(detail, '_id'),\n                    homeareas: newHAData\n                }\n            }\n            setOkLoader(true);\n            try {\n                let res = await axios({ ...mapPcc, data: request })\n                if (res) {\n                    if (res.code === 'OK') {\n                        Toast.success(res.message)\n                        onOk()\n                    } else\n                        Toast.error(res.message)\n                }\n                setOkLoader(false);\n            } catch {\n                setOkLoader(false);\n            }\n        })\n    }\n\n    return <>\n        <Dialog\n            visible={visible}\n            title={detail.facilityName}\n            onCancel={onCancel}\n            onOk={handleOk}\n            okButtonProps={{\n                loading: okLoader\n            }}\n            width={650}\n        >\n            <div className=\"form_row\">\n                <div className=\"col-12\">\n                    <div className=\"title\">\n                        <label className=\"filter_check\">\n                            <input type=\"checkbox\" name=\"type\"\n                                value={ADD_TYEPS.NEW}\n                                checked={addAs === ADD_TYEPS.NEW}\n                                onChange={handleChangeAddAs}\n                            />\n                            <span className=\"checkbox radio\"></span>\n                            <span className=\"lbl\">Add as New facility in Writi</span>\n                        </label>\n                    </div>\n                </div>\n                <div className='col-12'>\n                    <div className=\"title\">\n                        <label className=\"filter_check\">\n                            <input type=\"checkbox\" name=\"type\"\n                                value={ADD_TYEPS.ADD_IN_EXISTING}\n                                checked={addAs === ADD_TYEPS.ADD_IN_EXISTING}\n                                onChange={handleChangeAddAs}\n                            />\n                            <span className=\"checkbox radio\"></span>\n                            <span className=\"lbl\">Map with Existing facility in Writi</span>\n                        </label>\n                    </div>\n                </div>\n                {\n                    addAs === ADD_TYEPS['ADD_IN_EXISTING'] ? <>\n                        <div className='form_group col-12 required'>\n                            <label>Writi Home<span>*</span></label>\n                            {getFieldDecorator('homeId', {\n                                rules: [{ required: true }],\n                            })(\n                                <Select placeholder=\"Select Home\"\n                                    loading={homeLoader}\n                                    showSearch\n                                    onChange={handleChangeHome}\n                                    allowClear\n                                    filterOption={(input, option) =>\n                                        option.props.children.toLowerCase().indexOf(input.toLowerCase()) >= 0\n                                    }>\n                                    {homeList.map((curObj) => {\n                                        return (\n                                            <Option key={curObj._id} value={curObj._id}>\n                                                {curObj.name}\n                                            </Option>\n                                        );\n                                    })\n                                    }\n                                </Select>\n                            )}\n                            {(errors = getFieldError('homeId')) ? (\n                                <ErrorMsg errors={errors} />\n                            ) : null}\n                        </div>\n                        {\n                            floors.map((floor, index) => {\n                                return (\n                                    <>\n                                        <div className='form_group col-6 required'>\n                                            <label>PointClickCare Floor<span>*</span></label>\n                                            <label>{floor.floorDesc}</label>\n                                        </div>\n                                        <div className='form_group col-6 required'>\n                                            <label>Writi Home Area<span>*</span></label>\n                                            {getFieldDecorator('homeArea' + floor.floorId, {\n                                                rules: [{ required: true }]\n                                            })(\n                                                <Select\n                                                    loading={loader}\n                                                    placeholder={\"Select Home Area\"}\n                                                    showSearch\n                                                    allowClear\n                                                    filterOption={(input, option) =>\n                                                        option.props.children.toLowerCase().indexOf(input.toLowerCase()) >= 0\n                                                    }\n                                                // onChange={(val1, val2) => handleChangeInSelectHomearea(val1, val2, floor.floorId)}\n                                                // onDeselect={handleChangeInSelectHomearea}\n\n                                                >\n                                                    {homeAreas.length > 0\n                                                        ? homeAreas.map((curObj) => {\n                                                            return (\n                                                                <Option key={curObj._id} value={curObj._id}>\n                                                                    {curObj.name}\n                                                                </Option>\n                                                            );\n                                                        })\n                                                        : null}\n                                                </Select>\n                                            )}\n                                            {(errors = getFieldError('homeArea')) ? (\n                                                <ErrorMsg errors={errors} />\n                                            ) : null}\n                                        </div>\n                                    </>\n                                );\n                            })\n                        }\n\n                    </>\n                        : null\n                }\n            </div>\n        </Dialog>\n\n    </>\n}\n\nexport default memo(createForm()(MappingModal))"]},"metadata":{},"sourceType":"module"}