{"ast":null,"code":"var _jsxFileName = \"/home/gauravpendherkar/DemoWriti/src/containers/ResidentDetail/View/timeline.js\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { createForm } from \"rc-form\";\nimport { Calendar, dateFnsLocalizer, Views } from \"react-big-calendar\";\nimport moment from \"moment\";\nimport format from \"date-fns/format\";\nimport parse from \"date-fns/parse\";\nimport startOfWeek from \"date-fns/startOfWeek\";\nimport getDay from \"date-fns/getDay\";\nimport { Timeline } from \"../../../services/api/routes/globalSearch\";\nimport \"react-month-picker/css/month-picker.css\";\nimport axios, { getRxImage, getPrivateBucketUrl } from \"../../../services/api/services/common\";\nimport { Toast, Select, Option, LightBox } from \"../../../components/common\";\nimport _ from \"lodash\";\nimport { MODULE } from \"../../../constants/subscription\";\nimport { connect } from \"react-redux\";\nimport TimelineModel from \"./timeLineModel\";\nimport { DEVICE_VIEW, STATUS, TODO_CATEGORY } from \"../../../constants/todo\";\nimport { getTodoRedirectUrl } from \"../../../util/todo\";\nimport { da } from \"date-fns/locale\";\n\nconst OrderTab = props => {\n  const {\n    resident,\n    isTabActive\n  } = props;\n  const [visible, setVisibile] = useState(false);\n  const [month, setMonth] = useState(moment().month() + 1);\n  const [year, setYear] = useState(moment().year());\n  const [date, setDate] = useState(new Date());\n  const [data, setData] = useState([]);\n  const [modelData, setModelData] = useState([]);\n  const [todayData, setTodayData] = useState([]);\n  const [yesterdayData, setYesterdayData] = useState([]);\n  const [apiFilter, setApiFilter] = useState({\n    date: `${year}/${month}`,\n    find: {\n      residentId: resident.currentResidentId\n    },\n    populate: [{\n      printedOrderList: []\n    }]\n  });\n  const yesterday = moment().subtract(\"day\", 1).format(\"MM/DD/YYYY\");\n  const today = moment().format(\"MM/DD/YYYY\");\n\n  const handleChange = (name, e) => {\n    if (name === \"month\") {\n      setMonth(e + 1);\n      setApiFilter(data => {\n        return { ...data,\n          date: `${year}/${e + 1}`\n        };\n      });\n    } else {\n      setYear(e);\n      setApiFilter(data => {\n        return { ...data,\n          date: `${e}/${month}`\n        };\n      });\n    }\n  };\n\n  const columns = [{\n    title: \"OrderNumber\",\n    dataIndex: \"title\",\n    render: text => /*#__PURE__*/React.createElement(\"span\", {\n      style: {\n        textTransform: \"capitalize\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 9\n      }\n    }, text || \"-\")\n  }, {\n    title: \"Status\",\n    dataIndex: \"status\",\n    render: (text, record) => {\n      if (text === STATUS.COMPLETED) {\n        return \"Complete\";\n      } else if (text === STATUS.COMPLETED) {\n        return \"Complete\";\n      } else if (text === STATUS.CANCELLED) {\n        return \"X-Ray\";\n      } else if (text === STATUS.UNDO) {\n        return \"Undo\";\n      }\n    }\n  }];\n  useEffect(() => {\n    window.dispatchEvent(new Event(\"resize\"));\n  }, [props.isTabActive]);\n  useEffect(() => {\n    if (!isTabActive) return;\n    fetch();\n    setDate(new Date());\n  }, [apiFilter, isTabActive]); // useEffect(()=>{\n  //   setTimeout(() => {\n  //       window.dispatchEvent(new Event('resize'))\n  //   }, 3000);\n  // },[data])\n\n  const handlingPmrRedirect = record => {\n    // if (!record.pendingTodoCount) return;\n    let url = getTodoRedirectUrl({\n      todoCategory: TODO_CATEGORY.MED_REVIEW,\n      subCategory: record.subCategory,\n      viewType: DEVICE_VIEW.PENDING,\n      orderNumber: record.orderNumber\n    });\n    window.open(url, \"_blank\");\n    return url;\n  };\n\n  const fetch = async () => {\n    let res = await axios({ ...Timeline,\n      data: {\n        query: { ...apiFilter\n        }\n      }\n    });\n\n    if (res) {\n      if (res.code === \"OK\") {\n        let temp = [];\n        let tempTodayData = [];\n        let tempYesterdayData = [];\n\n        _.map(Object.keys(res.data), d => {\n          temp = _.concat(temp, res.data[d]);\n        });\n\n        let events = _.map(temp, t => {\n          if (t.module === MODULE.PMR) {\n            t.title = t.pmrId;\n            t.allDay = false;\n          } else if (t.module === MODULE.RX_ORDER || t.module === MODULE.X_RAY_US) {\n            t.title = t.orderNumber;\n            t.allDay = false;\n          } else if (t.module === MODULE.RESIDENT_DOCUMENT) {\n            t.title = t.residentDocId;\n            t.allDay = false;\n          }\n\n          if (moment(t.updatedAt).format(\"MM/DD/YYYY\") === moment(today).format(\"MM/DD/YYYY\")) {\n            tempTodayData.push(t);\n          }\n\n          if (moment(t.updatedAt).format(\"MM/DD/YYYY\") === moment(yesterday).format(\"MM/DD/YYYY\")) {\n            tempYesterdayData.push(t);\n          }\n\n          return t;\n        });\n\n        if (_.size(tempTodayData)) {\n          setTodayData(tempTodayData);\n        }\n\n        if (_.size(tempYesterdayData)) {\n          setYesterdayData(tempYesterdayData);\n        }\n\n        setData(events);\n      } else Toast.error(res.message);\n    }\n  };\n\n  const locales = {\n    \"en-CA\": require(\"date-fns/locale/en-CA\")\n  };\n  const localizer = dateFnsLocalizer({\n    format,\n    parse,\n    startOfWeek,\n    getDay,\n    locales\n  });\n\n  const handleTimelineView = data => {\n    if (data.module === MODULE.RX_ORDER || data.module === MODULE.E_PROCESSING) {\n      if (_.size(data.attachments)) {\n        handleViewImages(true, data);\n      } else {\n        Toast.info(\"There is no attachments.\");\n      }\n    } else if (data.module === MODULE.RESIDENT_DOCUMENT) {\n      if (_.size(data.documents)) {\n        let attachments = [];\n\n        _.forEach(data.documents, (d, i) => {\n          const t = {\n            path: d.path,\n            id: i.toString()\n          };\n          attachments.push(t);\n          return;\n        });\n\n        getPrivateBucketUrl(attachments).then(data => {\n          data = _.map(data, d => {\n            d.src = d.path;\n            return d;\n          });\n          setDetail({\n            attachments: data\n          });\n          setVisibleImage(true);\n        }).catch(error => {\n          Toast.error(\"Something went wrong\");\n        });\n      } else {\n        Toast.info(\"There is no attachments.\");\n      }\n    } else if (data.module === MODULE.PMR) {\n      if (_.size(data.pendingTodo)) {\n        data.pendingTodo = _.orderBy(data.pendingTodo, [\"sequence\"], [\"asc\"]);\n        const redirectObject = {\n          subCategory: data.pendingTodo[0].subCategory,\n          viewType: DEVICE_VIEW.PENDING,\n          orderNumber: data.pmrId\n        };\n        handlingPmrRedirect(redirectObject);\n      } else if (_.size(data.printedOrderList)) {\n        let attachments = [];\n\n        _.map(data.printedOrderList, d => {\n          _.map(d.attachments, attachment => {\n            attachments.push({\n              src: attachment.path\n            });\n          });\n\n          data.attachments = attachments;\n          return d;\n        });\n\n        setDetail(data);\n        setVisibleImage(true);\n      } else {\n        Toast.info(\"There is no attachments.\");\n      }\n    }\n  };\n\n  const [imgLoader, setImgLoader] = useState(false);\n  const [visibleImage, setVisibleImage] = useState(false);\n  const [detail, setDetail] = useState(null);\n  const currentResident = resident.openedResidents[resident.currentResidentId];\n  const residentName = `${currentResident.mergeLFName} (Room No ${currentResident.room})`;\n  const MONTHS_NAMES_FULL = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n\n  const handleShowMore = e => {\n    setModelData(e);\n    setVisibile(true);\n  }; // const prepareAttachments = () => {\n  //   let imageViewer = [];\n  //   if (detail?.attachments?.length > 0) {\n  //     imageViewer = _.reverse(\n  //     console.log(\"ðŸš€ ~ file: timeline.js ~ line 198 ~ prepareAttachments ~ imageViewer\", imageViewer)\n  //       _.map(detail.attachments, function (a) {\n  //         a.src = a.path;\n  //         return a;\n  //       })\n  //     );\n  //   }\n  //   return { imageViewer };\n  // };\n  // const { imageViewer } = prepareAttachments();\n\n\n  const handleViewImages = (visible, record) => {\n    if (visible) {\n      setImgLoader(true);\n      getRxImage([record._id]).then(resp => {\n        if (resp === null || resp === void 0 ? void 0 : resp[0]) record.attachments = resp[0].attachments;\n        record.attachments = _.reverse(record.attachments.map((x, i) => {\n          x.caption = `${record.orderNumber}-${i + 1}`;\n          x.src = x.path;\n          return x;\n        }));\n        setVisibleImage(visible);\n        setDetail(record);\n        setImgLoader(false);\n      }).catch(err => {\n        setImgLoader(false);\n      });\n    } else {\n      setVisibleImage(visible);\n      setDetail(record);\n    }\n  };\n\n  const onClose = e => {\n    setVisibile(false);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"timeline_wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 11\n    }\n  }, residentName), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex m-10\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    defaultValue: date.getFullYear(),\n    onChange: e => handleChange(\"year\", e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 15\n    }\n  }, [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1].map((key, index) => {\n    return /*#__PURE__*/React.createElement(Option, {\n      value: index + 2010,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 28\n      }\n    }, index + 2010);\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    defaultValue: date.getMonth(),\n    onChange: e => handleChange(\"month\", e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 15\n    }\n  }, MONTHS_NAMES_FULL.map((month, index) => /*#__PURE__*/React.createElement(Option, {\n    key: month,\n    value: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 19\n    }\n  }, month)))))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex m-10\",\n    style: {\n      marginTop: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-9\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Calendar, {\n    localizer: localizer,\n    events: data,\n    startAccessor: \"updatedAt\",\n    endAccessor: \"updatedAt\",\n    style: {\n      height: \"100%\"\n    } // onEventResize={() => console.log(\"---------------------------------\")}\n    // onRangeChange={(e) => console.log(e)}\n    ,\n    views: [Views.MONTH],\n    toolbar: false,\n    date: new Date(year, month - 1, 1),\n    onShowMore: e => handleShowMore(e),\n    onSelectEvent: handleTimelineView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-3 rightStatusbar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"rightResidentAction\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"residentTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 15\n    }\n  }, \"Today - \", today), _.size(todayData) > 0 ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ActionTable\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex residentTop\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"col-6 subTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 21\n    }\n  }, \"OrderNumber\"), /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"col-6 subTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 21\n    }\n  }, \"Status\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"residentListing\",\n    style: {\n      overFlowY: \"scroll\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 19\n    }\n  }, _.map(todayData, d => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex residentTopList\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"col-6 listLeft\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 27\n      }\n    }, d.title), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"col-6 listRight\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 27\n      }\n    }, d.status === STATUS.COMPLETED ? \"Complete\" : d.status === STATUS.CANCELLED ? \"Cancelled\" : d.status === STATUS.UNDO ? \"Undo\" : d.status === STATUS.SUBMITTED ? \"Submitted\" : \"\"));\n  }))) : \"\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"rightResidentAction\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"residentTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 15\n    }\n  }, \"Yesterday - \", yesterday), _.size(yesterdayData) > 0 ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ActionTable\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex residentTop\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"col-6 subTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 21\n    }\n  }, \"OrderNumber\"), /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"col-6 subTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 21\n    }\n  }, \"Status\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"residentListing\",\n    style: {\n      overFlowY: \"scroll\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 19\n    }\n  }, _.map(yesterdayData, d => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex residentTopList\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"col-6 listLeft\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 27\n      }\n    }, d.title), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"col-6 listRight\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 420,\n        columnNumber: 27\n      }\n    }, d.status === STATUS.COMPLETED ? \"Complete\" : d.status === STATUS.CANCELLED ? \"Cancelled\" : d.status === STATUS.UNDO ? \"Undo\" : d.status === STATUS.SUBMITTED ? \"Submitted\" : \"\"));\n  }))) : \"\"))), visibleImage && (detail === null || detail === void 0 ? void 0 : detail.attachments.length) > 0 ? /*#__PURE__*/React.createElement(LightBox, {\n    visible: visibleImage,\n    images: detail.attachments,\n    onCloseRequest: () => handleViewImages(false, null),\n    curImg: 0,\n    imageTitle: {\n      caption: true\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 443,\n      columnNumber: 11\n    }\n  }) : null, visible && /*#__PURE__*/React.createElement(TimelineModel, {\n    handleTimelineView: handleTimelineView,\n    visible: visible,\n    title: \"Details\",\n    onCancel: onClose,\n    onClose: onClose,\n    maskClosable: false,\n    onOk: onClose,\n    data: modelData,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 452,\n      columnNumber: 11\n    }\n  })));\n};\n\nconst mapStateToProps = ({\n  resident\n}) => {\n  return {\n    resident\n  };\n};\n\nexport default connect(mapStateToProps)(createForm()(OrderTab)); // export default connect(mapStateToProps)(Residents)","map":{"version":3,"sources":["/home/gauravpendherkar/DemoWriti/src/containers/ResidentDetail/View/timeline.js"],"names":["React","useState","useEffect","useRef","createForm","Calendar","dateFnsLocalizer","Views","moment","format","parse","startOfWeek","getDay","Timeline","axios","getRxImage","getPrivateBucketUrl","Toast","Select","Option","LightBox","_","MODULE","connect","TimelineModel","DEVICE_VIEW","STATUS","TODO_CATEGORY","getTodoRedirectUrl","da","OrderTab","props","resident","isTabActive","visible","setVisibile","month","setMonth","year","setYear","date","setDate","Date","data","setData","modelData","setModelData","todayData","setTodayData","yesterdayData","setYesterdayData","apiFilter","setApiFilter","find","residentId","currentResidentId","populate","printedOrderList","yesterday","subtract","today","handleChange","name","e","columns","title","dataIndex","render","text","textTransform","record","COMPLETED","CANCELLED","UNDO","window","dispatchEvent","Event","fetch","handlingPmrRedirect","url","todoCategory","MED_REVIEW","subCategory","viewType","PENDING","orderNumber","open","res","query","code","temp","tempTodayData","tempYesterdayData","map","Object","keys","d","concat","events","t","module","PMR","pmrId","allDay","RX_ORDER","X_RAY_US","RESIDENT_DOCUMENT","residentDocId","updatedAt","push","size","error","message","locales","require","localizer","handleTimelineView","E_PROCESSING","attachments","handleViewImages","info","documents","forEach","i","path","id","toString","then","src","setDetail","setVisibleImage","catch","pendingTodo","orderBy","redirectObject","attachment","imgLoader","setImgLoader","visibleImage","detail","currentResident","openedResidents","residentName","mergeLFName","room","MONTHS_NAMES_FULL","handleShowMore","_id","resp","reverse","x","caption","err","onClose","getFullYear","key","index","getMonth","marginTop","height","MONTH","overFlowY","status","SUBMITTED","length","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { createForm } from \"rc-form\";\nimport { Calendar, dateFnsLocalizer, Views } from \"react-big-calendar\";\nimport moment from \"moment\";\nimport format from \"date-fns/format\";\nimport parse from \"date-fns/parse\";\nimport startOfWeek from \"date-fns/startOfWeek\";\nimport getDay from \"date-fns/getDay\";\nimport { Timeline } from \"../../../services/api/routes/globalSearch\";\nimport \"react-month-picker/css/month-picker.css\";\nimport axios, {\n  getRxImage,\n  getPrivateBucketUrl,\n} from \"../../../services/api/services/common\";\nimport { Toast, Select, Option, LightBox } from \"../../../components/common\";\nimport _ from \"lodash\";\nimport { MODULE } from \"../../../constants/subscription\";\nimport { connect } from \"react-redux\";\nimport TimelineModel from \"./timeLineModel\";\nimport { DEVICE_VIEW, STATUS, TODO_CATEGORY } from \"../../../constants/todo\";\nimport { getTodoRedirectUrl } from \"../../../util/todo\";\nimport { da } from \"date-fns/locale\";\n\nconst OrderTab = (props) => {\n  const { resident, isTabActive } = props;\n  const [visible, setVisibile] = useState(false);\n  const [month, setMonth] = useState(moment().month() + 1);\n  const [year, setYear] = useState(moment().year());\n  const [date, setDate] = useState(new Date());\n  const [data, setData] = useState([]);\n  const [modelData, setModelData] = useState([]);\n  const [todayData, setTodayData] = useState([]);\n  const [yesterdayData, setYesterdayData] = useState([]);\n\n  const [apiFilter, setApiFilter] = useState({\n    date: `${year}/${month}`,\n    find: {\n      residentId: resident.currentResidentId,\n    },\n    populate: [\n      {\n        printedOrderList: [],\n      },\n    ],\n  });\n  const yesterday = moment().subtract(\"day\", 1).format(\"MM/DD/YYYY\");\n  const today = moment().format(\"MM/DD/YYYY\");\n  const handleChange = (name, e) => {\n    if (name === \"month\") {\n      setMonth(e + 1);\n      setApiFilter((data) => {\n        return {\n          ...data,\n          date: `${year}/${e + 1}`,\n        };\n      });\n    } else {\n      setYear(e);\n      setApiFilter((data) => {\n        return {\n          ...data,\n          date: `${e}/${month}`,\n        };\n      });\n    }\n  };\n\n  const columns = [\n    {\n      title: \"OrderNumber\",\n      dataIndex: \"title\",\n      render: (text) => (\n        <span style={{ textTransform: \"capitalize\" }}>{text || \"-\"}</span>\n      ),\n    },\n    {\n      title: \"Status\",\n      dataIndex: \"status\",\n      render: (text, record) => {\n        if (text === STATUS.COMPLETED) {\n          return \"Complete\";\n        } else if (text === STATUS.COMPLETED) {\n          return \"Complete\";\n        } else if (text === STATUS.CANCELLED) {\n          return \"X-Ray\";\n        } else if (text === STATUS.UNDO) {\n          return \"Undo\";\n        }\n      },\n    },\n  ];\n\n  useEffect(() => {\n    window.dispatchEvent(new Event(\"resize\"));\n  }, [props.isTabActive]);\n\n  useEffect(() => {\n    if (!isTabActive) return;\n    fetch();\n    setDate(new Date());\n  }, [apiFilter, isTabActive]);\n\n  // useEffect(()=>{\n  //   setTimeout(() => {\n  //       window.dispatchEvent(new Event('resize'))\n  //   }, 3000);\n  // },[data])\n\n  const handlingPmrRedirect = (record) => {\n    // if (!record.pendingTodoCount) return;\n    let url = getTodoRedirectUrl({\n      todoCategory: TODO_CATEGORY.MED_REVIEW,\n      subCategory: record.subCategory,\n      viewType: DEVICE_VIEW.PENDING,\n      orderNumber: record.orderNumber,\n    });\n    window.open(url, \"_blank\");\n    return url;\n  };\n\n  const fetch = async () => {\n    let res = await axios({ ...Timeline, data: { query: { ...apiFilter } } });\n    if (res) {\n      if (res.code === \"OK\") {\n        let temp = [];\n        let tempTodayData = [];\n        let tempYesterdayData = [];\n        _.map(Object.keys(res.data), (d) => {\n          temp = _.concat(temp, res.data[d]);\n        });\n        let events = _.map(temp, (t) => {\n          if (t.module === MODULE.PMR) {\n            t.title = t.pmrId;\n            t.allDay = false;\n          } else if (\n            t.module === MODULE.RX_ORDER ||\n            t.module === MODULE.X_RAY_US\n          ) {\n            t.title = t.orderNumber;\n\n            t.allDay = false;\n          } else if (t.module === MODULE.RESIDENT_DOCUMENT) {\n            t.title = t.residentDocId;\n\n            t.allDay = false;\n          }\n          if (\n            moment(t.updatedAt).format(\"MM/DD/YYYY\") ===\n            moment(today).format(\"MM/DD/YYYY\")\n          ) {\n            tempTodayData.push(t);\n          }\n          if (\n            moment(t.updatedAt).format(\"MM/DD/YYYY\") ===\n            moment(yesterday).format(\"MM/DD/YYYY\")\n          ) {\n            tempYesterdayData.push(t);\n          }\n          return t;\n        });\n        if (_.size(tempTodayData)) {\n          setTodayData(tempTodayData);\n        }\n        if (_.size(tempYesterdayData)) {\n          setYesterdayData(tempYesterdayData);\n        }\n\n        setData(events);\n      } else Toast.error(res.message);\n    }\n  };\n\n  const locales = {\n    \"en-CA\": require(\"date-fns/locale/en-CA\"),\n  };\n  const localizer = dateFnsLocalizer({\n    format,\n    parse,\n    startOfWeek,\n    getDay,\n    locales,\n  });\n\n  const handleTimelineView = (data) => {\n    if (\n      data.module === MODULE.RX_ORDER ||\n      data.module === MODULE.E_PROCESSING\n    ) {\n      if (_.size(data.attachments)) {\n        handleViewImages(true, data);\n      } else {\n        Toast.info(\"There is no attachments.\");\n      }\n    } else if (data.module === MODULE.RESIDENT_DOCUMENT) {\n      if (_.size(data.documents)) {\n        let attachments = [];\n        _.forEach(data.documents, (d, i) => {\n          const t = {\n            path: d.path,\n            id: i.toString(),\n          };\n          attachments.push(t);\n          return;\n        });\n        getPrivateBucketUrl(attachments)\n          .then((data) => {\n            data = _.map(data, (d) => {\n              d.src = d.path;\n              return d;\n            });\n            setDetail({ attachments: data });\n            setVisibleImage(true);\n          })\n          .catch((error) => {\n            Toast.error(\"Something went wrong\");\n          });\n      } else {\n        Toast.info(\"There is no attachments.\");\n      }\n    } else if (data.module === MODULE.PMR) {\n      if (_.size(data.pendingTodo)) {\n        data.pendingTodo = _.orderBy(data.pendingTodo, [\"sequence\"], [\"asc\"]);\n        const redirectObject = {\n          subCategory: data.pendingTodo[0].subCategory,\n          viewType: DEVICE_VIEW.PENDING,\n          orderNumber: data.pmrId,\n        };\n        handlingPmrRedirect(redirectObject);\n      } else if (_.size(data.printedOrderList)) {\n        let attachments = [];\n        _.map(data.printedOrderList, (d) => {\n          _.map(d.attachments, (attachment) => {\n            attachments.push({ src: attachment.path });\n          });\n          data.attachments = attachments;\n\n          return d;\n        });\n        setDetail(data);\n        setVisibleImage(true);\n      } else {\n        Toast.info(\"There is no attachments.\");\n      }\n    }\n  };\n  const [imgLoader, setImgLoader] = useState(false);\n  const [visibleImage, setVisibleImage] = useState(false);\n  const [detail, setDetail] = useState(null);\n\n  const currentResident = resident.openedResidents[resident.currentResidentId];\n  const residentName = `${currentResident.mergeLFName} (Room No ${currentResident.room})`;\n  const MONTHS_NAMES_FULL = [\n    \"January\",\n    \"February\",\n    \"March\",\n    \"April\",\n    \"May\",\n    \"June\",\n    \"July\",\n    \"August\",\n    \"September\",\n    \"October\",\n    \"November\",\n    \"December\",\n  ];\n  const handleShowMore = (e) => {\n    setModelData(e);\n    setVisibile(true);\n  };\n  // const prepareAttachments = () => {\n  //   let imageViewer = [];\n  //   if (detail?.attachments?.length > 0) {\n  //     imageViewer = _.reverse(\n  //     console.log(\"ðŸš€ ~ file: timeline.js ~ line 198 ~ prepareAttachments ~ imageViewer\", imageViewer)\n  //       _.map(detail.attachments, function (a) {\n  //         a.src = a.path;\n  //         return a;\n  //       })\n  //     );\n  //   }\n  //   return { imageViewer };\n  // };\n  // const { imageViewer } = prepareAttachments();\n\n  const handleViewImages = (visible, record) => {\n    if (visible) {\n      setImgLoader(true);\n      getRxImage([record._id])\n        .then((resp) => {\n          if (resp?.[0]) record.attachments = resp[0].attachments;\n          record.attachments = _.reverse(\n            record.attachments.map((x, i) => {\n              x.caption = `${record.orderNumber}-${i + 1}`;\n              x.src = x.path;\n              return x;\n            })\n          );\n          setVisibleImage(visible);\n          setDetail(record);\n          setImgLoader(false);\n        })\n        .catch((err) => {\n          setImgLoader(false);\n        });\n    } else {\n      setVisibleImage(visible);\n      setDetail(record);\n    }\n  };\n\n  const onClose = (e) => {\n    setVisibile(false);\n  };\n  return (\n    <>\n      <div className=\"timeline_wrap\">\n        <div className=\"head\">\n          <h4>{residentName}</h4>\n          <div className=\"d-flex m-10\">\n            <div className=\"col-4\">\n              <Select\n                defaultValue={date.getFullYear()}\n                onChange={(e) => handleChange(\"year\", e)}\n              >\n                {[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1].map(\n                  (key, index) => {\n                    return <Option value={index + 2010}>{index + 2010}</Option>;\n                  }\n                )}\n              </Select>\n            </div>\n            <div className=\"col-4\">\n              <Select\n                defaultValue={date.getMonth()}\n                onChange={(e) => handleChange(\"month\", e)}\n              >\n                {MONTHS_NAMES_FULL.map((month, index) => (\n                  <Option key={month} value={index}>\n                    {month}\n                  </Option>\n                ))}\n              </Select>\n            </div>\n          </div>\n        </div>\n        <div className=\"d-flex m-10\" style={{ marginTop: 10 }}>\n          <div className=\"col-9\">\n            <Calendar\n              localizer={localizer}\n              events={data}\n              startAccessor=\"updatedAt\"\n              endAccessor=\"updatedAt\"\n              style={{ height: \"100%\" }}\n              // onEventResize={() => console.log(\"---------------------------------\")}\n              // onRangeChange={(e) => console.log(e)}\n              views={[Views.MONTH]}\n              toolbar={false}\n              date={new Date(year, month - 1, 1)}\n              onShowMore={(e) => handleShowMore(e)}\n              onSelectEvent={handleTimelineView}\n            />\n          </div>\n          <div className=\"col-3 rightStatusbar\">\n            <div className=\"rightResidentAction\">\n              <h2 className=\"residentTitle\">Today - {today}</h2>\n              {_.size(todayData) > 0 ? (\n                <div className=\"ActionTable\">\n                  <div className=\"d-flex residentTop\">\n                    <h3 className=\"col-6 subTitle\">OrderNumber</h3>\n                    <h3 className=\"col-6 subTitle\">Status</h3>\n                  </div>\n                  <div\n                    className=\"residentListing\"\n                    style={{\n                      overFlowY: \"scroll\",\n                    }}\n                  >\n                    {_.map(todayData, (d) => {\n                      return (\n                        <div className=\"d-flex residentTopList\">\n                          <span className=\"col-6 listLeft\">{d.title}</span>\n                          <span className=\"col-6 listRight\">\n                            {d.status === STATUS.COMPLETED\n                              ? \"Complete\"\n                              : d.status === STATUS.CANCELLED\n                              ? \"Cancelled\"\n                              : d.status === STATUS.UNDO\n                              ? \"Undo\"\n                              : d.status === STATUS.SUBMITTED\n                              ? \"Submitted\"\n                              : \"\"}\n                          </span>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              ) : (\n                \"\"\n              )}\n            </div>\n            <div className=\"rightResidentAction\">\n              <h2 className=\"residentTitle\">Yesterday - {yesterday}</h2>\n              {_.size(yesterdayData) > 0 ? (\n                <div className=\"ActionTable\">\n                  <div className=\"d-flex residentTop\">\n                    <h3 className=\"col-6 subTitle\">OrderNumber</h3>\n                    <h3 className=\"col-6 subTitle\">Status</h3>\n                  </div>\n                  <div\n                    className=\"residentListing\"\n                    style={{\n                      overFlowY: \"scroll\",\n                    }}\n                  >\n                    {_.map(yesterdayData, (d) => {\n                      return (\n                        <div className=\"d-flex residentTopList\">\n                          <span className=\"col-6 listLeft\">{d.title}</span>\n                          <span className=\"col-6 listRight\">\n                            {d.status === STATUS.COMPLETED\n                              ? \"Complete\"\n                              : d.status === STATUS.CANCELLED\n                              ? \"Cancelled\"\n                              : d.status === STATUS.UNDO\n                              ? \"Undo\"\n                              : d.status === STATUS.SUBMITTED\n                              ? \"Submitted\"\n                              : \"\"}\n                          </span>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              ) : (\n                \"\"\n              )}\n            </div>\n          </div>\n        </div>\n        {visibleImage && detail?.attachments.length > 0 ? (\n          <LightBox\n            visible={visibleImage}\n            images={detail.attachments}\n            onCloseRequest={() => handleViewImages(false, null)}\n            curImg={0}\n            imageTitle={{ caption: true }}\n          />\n        ) : null}\n        {visible && (\n          <TimelineModel\n            handleTimelineView={handleTimelineView}\n            visible={visible}\n            title={\"Details\"}\n            onCancel={onClose}\n            onClose={onClose}\n            maskClosable={false}\n            onOk={onClose}\n            data={modelData}\n          />\n        )}\n      </div>\n    </>\n  );\n};\n\nconst mapStateToProps = ({ resident }) => {\n  return { resident };\n};\nexport default connect(mapStateToProps)(createForm()(OrderTab));\n\n// export default connect(mapStateToProps)(Residents)\n"]},"metadata":{},"sourceType":"module"}