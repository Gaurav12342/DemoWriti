{"ast":null,"code":"var _jsxFileName = \"/home/gauravpendherkar/DemoWriti/src/containers/SubscriptionUpsert/index.js\";\nimport React, { Component } from 'react';\nimport PermissionSidebar from './components/SideBar';\nimport UpsertContainer from './components/UpsertContainer';\nimport axios from '../../services/api/services/common';\nimport { getAll, remove } from '../../services/api/routes/subscription';\nimport { sortArrayDesc } from '../../util/common';\nimport { Toast } from '../../components/common';\nlet delayDebounceFn;\n\nclass AddPermissionsClass extends Component {\n  constructor(props) {\n    super(props);\n\n    this.fetch = async () => {\n      this.setState({\n        listLoader: this.state.filter.page === 1 ? true : false\n      });\n      const data = {\n        query: { ...this.state.filter\n        }\n      };\n\n      try {\n        let res = await axios({ ...getAll,\n          data\n        });\n\n        if (res) {\n          if (res.code === 'OK') {\n            let listData = this.state.filter.page === 1 ? [] : [...this.state.listData];\n            listData = listData.concat(res.data.data);\n            this.setState({\n              hasMore: listData.length === res.data.count ? false : true,\n              loading: false,\n              count: res.data.count,\n              listData: listData,\n              detail: listData.length > 0 ? listData[0] : null\n            });\n          }\n        }\n\n        this.setState({\n          listLoader: false\n        });\n      } catch {\n        this.setState({\n          listLoader: false,\n          loading: false\n        });\n      }\n    };\n\n    this.handleInfiniteLoad = () => {\n      let tempArr = [...this.state.listData];\n\n      if (tempArr.length === this.state.count) {\n        this.setState({\n          hasMore: false\n        });\n        return;\n      }\n\n      this.setState({\n        loading: true,\n        filter: { ...this.state.filter,\n          page: this.state.filter.page + 1\n        }\n      }, () => this.fetch());\n    };\n\n    this.handleSearch = value => {\n      if (delayDebounceFn) {\n        clearTimeout(delayDebounceFn);\n        delayDebounceFn = null;\n      }\n\n      delayDebounceFn = setTimeout(() => {\n        this.setState({\n          filter: { ...this.state.filter,\n            page: 1,\n            search: {\n              keyword: value,\n              keys: ['name']\n            }\n          }\n        }, () => this.fetch());\n      }, 600);\n    };\n\n    this.handleAdd = () => {\n      this.setState({\n        curDetail: { ...this.state.detail\n        }\n      });\n      this.setState({\n        visibleAdd: true,\n        detail: null\n      });\n    };\n\n    this.submit = () => {\n      this.props.form.validateFields((error, value) => {\n        console.log(error, value);\n      });\n    };\n\n    this.handleEdit = detail => {\n      this.setState({\n        curDetail: { ...detail\n        }\n      });\n      this.setState({\n        edit: true,\n        visibleAdd: true,\n        detail\n      });\n    };\n\n    this.handleDelete = async data => {\n      this.setState({\n        listLoader: true\n      });\n      const {\n        method,\n        url,\n        baseURL\n      } = remove;\n      let res = await axios({\n        method,\n        url: url + data._id,\n        data,\n        baseURL\n      });\n\n      if (res && res.code === 'OK') {\n        Toast.success(res.message);\n        let listData = [...this.state.listData];\n        let index = listData.findIndex(x => x._id === data._id);\n        if (index >= 0) listData.splice(index, 1);\n        this.setState({\n          listData: listData\n        });\n\n        if (this.state.detail && this.state.detail._id && this.state.detail._id !== data._id) {//stay as it is while delete\n        } else {\n          this.setState({\n            detail: listData.length > 0 ? listData[0] : null\n          });\n        }\n      }\n\n      this.setState({\n        listLoader: false\n      });\n    };\n\n    this.handleSelect = detail => {\n      this.setState({\n        visibleAdd: false,\n        edit: false,\n        detail\n      });\n    };\n\n    this.handleCancel = (str, params) => {\n      let newDetail = null;\n\n      if (str === 'add') {\n        newDetail = this.state.listData[0];\n      } else if (this.state.curDetail) {\n        newDetail = { ...this.state.curDetail,\n          name: params ? params.name : this.state.curDetail.name\n        };\n      }\n\n      this.setState({\n        visibleAdd: false,\n        edit: false,\n        detail: newDetail\n      });\n    };\n\n    this.handleUpdate = params => {\n      let edit = false;\n      let listData = [...this.state.listData];\n      let index = listData.findIndex(x => x._id === params._id);\n\n      if (index >= 0) {\n        //edit\n        edit = true;\n        listData[index] = params;\n      } else listData.push(params);\n\n      listData = sortArrayDesc(listData, 'createdAt');\n      this.setState({\n        listData: listData\n      });\n      this.handleCancel(edit ? 'edit' : 'add', edit ? params : null);\n    };\n\n    this.state = {\n      // showAdd: false,\n      visibleAdd: false,\n      listLoader: false,\n      loading: false,\n      hasMore: true,\n      edit: false,\n      detail: null,\n      listData: [],\n      count: 0,\n      filter: {\n        page: 1,\n        limit: 15,\n        fields: ['isActive', '_id', 'name', 'groupPermissions', 'createdAt'],\n        \"populate\": [{\n          \"groupPermissions\": null\n        }],\n        sortBy: {\n          createdAt: -1\n        },\n        find: {}\n      },\n      curDetail: null\n    };\n  }\n\n  componentDidMount() {\n    this.fetch();\n  }\n\n  render() {\n    const {\n      visibleAdd,\n      edit,\n      detail,\n      listData,\n      listLoader,\n      hasMore,\n      loading\n    } = this.state;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"addpermission_wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(PermissionSidebar, {\n      onAdd: this.handleAdd,\n      listData: listData,\n      onEdit: this.handleEdit,\n      onDelete: this.handleDelete,\n      onSelect: this.handleSelect,\n      onSearch: this.handleSearch,\n      onInfiniteOnLoad: this.handleInfiniteLoad,\n      hasMore: hasMore,\n      loading: loading,\n      edit: edit,\n      detail: detail,\n      listLoader: listLoader,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 21\n      }\n    }),\n    /*#__PURE__*/\n    // detail &&\n    React.createElement(UpsertContainer, {\n      visibleAdd: visibleAdd,\n      onAdd: this.handleUpdate,\n      edit: edit,\n      onCancel: this.handleCancel,\n      detail: detail,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 25\n      }\n    }))));\n  }\n\n}\n\nexport default AddPermissionsClass;","map":{"version":3,"sources":["/home/gauravpendherkar/DemoWriti/src/containers/SubscriptionUpsert/index.js"],"names":["React","Component","PermissionSidebar","UpsertContainer","axios","getAll","remove","sortArrayDesc","Toast","delayDebounceFn","AddPermissionsClass","constructor","props","fetch","setState","listLoader","state","filter","page","data","query","res","code","listData","concat","hasMore","length","count","loading","detail","handleInfiniteLoad","tempArr","handleSearch","value","clearTimeout","setTimeout","search","keyword","keys","handleAdd","curDetail","visibleAdd","submit","form","validateFields","error","console","log","handleEdit","edit","handleDelete","method","url","baseURL","_id","success","message","index","findIndex","x","splice","handleSelect","handleCancel","str","params","newDetail","name","handleUpdate","push","limit","fields","sortBy","createdAt","find","componentDidMount","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PermissionSidebar from './components/SideBar';\nimport UpsertContainer from './components/UpsertContainer';\nimport axios from '../../services/api/services/common'\nimport { getAll, remove } from '../../services/api/routes/subscription'\nimport { sortArrayDesc } from '../../util/common'\nimport { Toast } from '../../components/common';\n\nlet delayDebounceFn\nclass AddPermissionsClass extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            // showAdd: false,\n            visibleAdd: false,\n            listLoader: false,\n            loading: false,\n            hasMore: true,\n            edit: false,\n            detail: null,\n            listData: [],\n            count: 0,\n            filter: {\n                page: 1,\n                limit: 15,\n                fields: ['isActive', '_id', 'name', 'groupPermissions', 'createdAt'],\n                \"populate\": [{ \"groupPermissions\": null }],\n                sortBy: { createdAt: -1 },\n                find: {\n\n                }\n            },\n            curDetail: null\n        };\n    }\n\n    componentDidMount() {\n        this.fetch()\n    }\n\n    fetch = async () => {\n        this.setState({ listLoader: this.state.filter.page === 1 ? true : false })\n        const data = { query: { ...this.state.filter } }\n        try {\n            let res = await axios({ ...getAll, data })\n            if (res) {\n                if (res.code === 'OK') {\n                    let listData = this.state.filter.page === 1 ? [] : [...this.state.listData]\n                    listData = listData.concat(res.data.data)\n                    this.setState({\n                        hasMore: listData.length === res.data.count ? false : true,\n                        loading: false,\n                        count: res.data.count,\n                        listData: listData,\n                        detail: listData.length > 0 ? listData[0] : null\n                    })\n                }\n            }\n            this.setState({ listLoader: false })\n        } catch{\n            this.setState({ listLoader: false, loading: false })\n        }\n    }\n\n    handleInfiniteLoad = () => {\n        let tempArr = [...this.state.listData]\n        if (tempArr.length === this.state.count) {\n            this.setState({ hasMore: false })\n            return\n        }\n        this.setState({\n            loading: true,\n            filter: {\n                ...this.state.filter,\n                page: this.state.filter.page + 1\n            }\n        }, () => this.fetch())\n    }\n\n    handleSearch = (value) => {\n        if (delayDebounceFn) {\n            clearTimeout(delayDebounceFn)\n            delayDebounceFn = null\n        }\n        delayDebounceFn = setTimeout(() => {\n            this.setState({\n                filter: {\n                    ...this.state.filter,\n                    page: 1,\n                    search: {\n                        keyword: value,\n                        keys: ['name'],\n                    }\n                }\n            }, () => this.fetch())\n        }, 600)\n    }\n\n    // handleResize = (e) => {\n    //     const showAdd = this.state.showAdd;\n    //     this.setState({ showAdd: !showAdd })\n    // };\n    handleAdd = () => {\n        this.setState({ curDetail: { ...this.state.detail } })\n        this.setState({ visibleAdd: true, detail: null })\n    }\n\n    submit = () => {\n        this.props.form.validateFields((error, value) => {\n            console.log(error, value);\n        });\n    }\n    handleEdit = (detail) => {\n        this.setState({ curDetail: { ...detail } })\n        this.setState({ edit: true, visibleAdd: true, detail })\n    }\n    handleDelete = async (data) => {\n        this.setState({ listLoader: true })\n        const { method, url, baseURL } = remove\n        let res = await axios({ method, url: url + data._id, data, baseURL })\n        if (res && res.code === 'OK') {\n            Toast.success(res.message)\n            let listData = [...this.state.listData]\n            let index = listData.findIndex(x => x._id === data._id)\n            if (index >= 0)\n                listData.splice(index, 1)\n            this.setState({\n                listData: listData,\n            })\n            if (this.state.detail && (this.state.detail._id && this.state.detail._id !== data._id)) {\n                //stay as it is while delete\n            } else {\n                this.setState({\n                    detail: listData.length > 0 ? listData[0] : null\n                })\n            }\n        }\n        this.setState({ listLoader: false })\n    }\n    handleSelect = (detail) => {\n        this.setState({ visibleAdd: false, edit: false, detail })\n    }\n    handleCancel = (str, params) => {\n        let newDetail = null\n        if (str === 'add') {\n            newDetail = this.state.listData[0]\n        } else if (this.state.curDetail) {\n            newDetail = {\n                ...this.state.curDetail,\n                name: params ? params.name : this.state.curDetail.name\n            }\n        }\n        this.setState({\n            visibleAdd: false, edit: false,\n            detail: newDetail\n        })\n    }\n\n    handleUpdate = (params) => {\n        let edit = false\n        let listData = [...this.state.listData]\n        let index = listData.findIndex(x => x._id === params._id)\n        if (index >= 0) {\n            //edit\n            edit = true\n            listData[index] = params\n        } else\n            listData.push(params)\n        listData = sortArrayDesc(listData, 'createdAt')\n        this.setState({ listData: listData })\n        this.handleCancel(edit ? 'edit' : 'add', edit ? params : null)\n    }\n\n    render() {\n        const { visibleAdd, edit, detail, listData, listLoader, hasMore, loading } = this.state\n\n        return (<>\n            <div className=\"container\">\n                <div className=\"addpermission_wrap\">\n                    <PermissionSidebar onAdd={this.handleAdd} listData={listData}\n                        onEdit={this.handleEdit} onDelete={this.handleDelete}\n                        onSelect={this.handleSelect}\n                        onSearch={this.handleSearch}\n                        onInfiniteOnLoad={this.handleInfiniteLoad} hasMore={hasMore} loading={loading}\n                        edit={edit} detail={detail} listLoader={listLoader} />\n                    {\n                        // detail &&\n                        <UpsertContainer visibleAdd={visibleAdd} onAdd={this.handleUpdate}\n                            edit={edit} onCancel={this.handleCancel} detail={detail} />\n                    }\n                </div>\n            </div>\n        </>);\n    }\n}\nexport default AddPermissionsClass;"]},"metadata":{},"sourceType":"module"}